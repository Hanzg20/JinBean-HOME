# æ’ä»¶å¼æ¶æ„è®¾è®¡

> æœ¬æ–‡æ¡£æè¿°äº†JinBeané¡¹ç›®çš„æ’ä»¶å¼æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬å…±äº«ç»„ä»¶ã€æ’ä»¶å¼€å‘åŸåˆ™å’Œæ¨¡å—åŒ–è®¾è®¡ã€‚

## ğŸ¯ æ’ä»¶å¼æ¶æ„åŸåˆ™

### 1. æ ¸å¿ƒåŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ’ä»¶åªè´Ÿè´£ç‰¹å®šåŠŸèƒ½
- **é«˜å†…èšä½è€¦åˆ**: æ’ä»¶å†…éƒ¨é«˜å†…èšï¼Œæ’ä»¶é—´ä½è€¦åˆ
- **å¯æ’æ‹”**: æ’ä»¶å¯ä»¥ç‹¬ç«‹å®‰è£…ã€å¸è½½ã€å¯ç”¨ã€ç¦ç”¨
- **å¯æ‰©å±•**: æ”¯æŒæ–°æ’ä»¶çš„åŠ¨æ€æ·»åŠ 
- **å¯å¤ç”¨**: å…±äº«ç»„ä»¶å¯åœ¨å¤šä¸ªæ’ä»¶é—´å¤ç”¨

### 2. è®¾è®¡ç›®æ ‡
- **ä»£ç å¤ç”¨**: é¿å…é‡å¤ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡
- **ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºç»´æŠ¤å’Œæ›´æ–°
- **çµæ´»æ€§**: æ”¯æŒä¸åŒå®¢æˆ·ç«¯çš„å®šåˆ¶åŒ–éœ€æ±‚
- **å¯æµ‹è¯•æ€§**: æ’ä»¶ç‹¬ç«‹æµ‹è¯•ï¼Œæé«˜æµ‹è¯•è¦†ç›–ç‡

## ğŸ— æ¶æ„å±‚æ¬¡

### 1. åŸºç¡€å±‚ (Base Layer)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€å±‚ (Base Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒæ¡†æ¶ (Core Framework)                                  â”‚
â”‚  â”œâ”€â”€ AppCore (åº”ç”¨æ ¸å¿ƒ)                                     â”‚
â”‚  â”œâ”€â”€ PluginManager (æ’ä»¶ç®¡ç†å™¨)                             â”‚
â”‚  â”œâ”€â”€ EventBus (äº‹ä»¶æ€»çº¿)                                    â”‚
â”‚  â””â”€â”€ Logger (æ—¥å¿—ç³»ç»Ÿ)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…±äº«åŸºç¡€è®¾æ–½ (Shared Infrastructure)                        â”‚
â”‚  â”œâ”€â”€ NetworkManager (ç½‘ç»œç®¡ç†)                              â”‚
â”‚  â”œâ”€â”€ StorageManager (å­˜å‚¨ç®¡ç†)                              â”‚
â”‚  â”œâ”€â”€ AuthManager (è®¤è¯ç®¡ç†)                                 â”‚
â”‚  â””â”€â”€ ConfigManager (é…ç½®ç®¡ç†)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å…±äº«å±‚ (Shared Layer)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…±äº«å±‚ (Shared Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…±äº«æ•°æ®æ¨¡å‹ (Shared Data Models)                          â”‚
â”‚  â”œâ”€â”€ User (ç”¨æˆ·æ¨¡å‹)                                        â”‚
â”‚  â”œâ”€â”€ Order (è®¢å•æ¨¡å‹)                                       â”‚
â”‚  â”œâ”€â”€ Service (æœåŠ¡æ¨¡å‹)                                     â”‚
â”‚  â”œâ”€â”€ Address (åœ°å€æ¨¡å‹)                                     â”‚
â”‚  â””â”€â”€ Notification (é€šçŸ¥æ¨¡å‹)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…±äº«æœåŠ¡ (Shared Services)                                 â”‚
â”‚  â”œâ”€â”€ ApiService (APIæœåŠ¡)                                   â”‚
â”‚  â”œâ”€â”€ DatabaseService (æ•°æ®åº“æœåŠ¡)                           â”‚
â”‚  â”œâ”€â”€ FileService (æ–‡ä»¶æœåŠ¡)                                 â”‚
â”‚  â””â”€â”€ CacheService (ç¼“å­˜æœåŠ¡)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…±äº«å·¥å…· (Shared Utils)                                    â”‚
â”‚  â”œâ”€â”€ Validators (éªŒè¯å™¨)                                    â”‚
â”‚  â”œâ”€â”€ Formatters (æ ¼å¼åŒ–å™¨)                                  â”‚
â”‚  â”œâ”€â”€ Extensions (æ‰©å±•æ–¹æ³•)                                  â”‚
â”‚  â””â”€â”€ Constants (å¸¸é‡å®šä¹‰)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ’ä»¶å±‚ (Plugin Layer)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ’ä»¶å±‚ (Plugin Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Provideræ’ä»¶ (Provider Plugins)                            â”‚
â”‚  â”œâ”€â”€ OrderManagementPlugin (è®¢å•ç®¡ç†æ’ä»¶)                   â”‚
â”‚  â”œâ”€â”€ ClientManagementPlugin (å®¢æˆ·ç®¡ç†æ’ä»¶)                  â”‚
â”‚  â”œâ”€â”€ ServiceManagementPlugin (æœåŠ¡ç®¡ç†æ’ä»¶)                 â”‚
â”‚  â””â”€â”€ IncomeManagementPlugin (æ”¶å…¥ç®¡ç†æ’ä»¶)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Customeræ’ä»¶ (Customer Plugins)                            â”‚
â”‚  â”œâ”€â”€ ServiceBookingPlugin (æœåŠ¡é¢„çº¦æ’ä»¶)                    â”‚
â”‚  â”œâ”€â”€ OrderTrackingPlugin (è®¢å•è·Ÿè¸ªæ’ä»¶)                     â”‚
â”‚  â”œâ”€â”€ PaymentPlugin (æ”¯ä»˜æ’ä»¶)                               â”‚
â”‚  â””â”€â”€ ReviewPlugin (è¯„ä»·æ’ä»¶)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€šç”¨æ’ä»¶ (Common Plugins)                                  â”‚
â”‚  â”œâ”€â”€ AuthPlugin (è®¤è¯æ’ä»¶)                                  â”‚
â”‚  â”œâ”€â”€ NotificationPlugin (é€šçŸ¥æ’ä»¶)                          â”‚
â”‚  â”œâ”€â”€ ChatPlugin (èŠå¤©æ’ä»¶)                                  â”‚
â”‚  â””â”€â”€ SettingsPlugin (è®¾ç½®æ’ä»¶)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. åº”ç”¨å±‚ (Application Layer)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Provideråº”ç”¨ (Provider App)                                â”‚
â”‚  â”œâ”€â”€ ProviderApp (Provideråº”ç”¨å…¥å£)                         â”‚
â”‚  â”œâ”€â”€ ProviderRouter (Providerè·¯ç”±)                          â”‚
â”‚  â””â”€â”€ ProviderTheme (Providerä¸»é¢˜)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Customeråº”ç”¨ (Customer App)                                â”‚
â”‚  â”œâ”€â”€ CustomerApp (Customeråº”ç”¨å…¥å£)                         â”‚
â”‚  â”œâ”€â”€ CustomerRouter (Customerè·¯ç”±)                          â”‚
â”‚  â””â”€â”€ CustomerTheme (Customerä¸»é¢˜)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å…±äº«ç»„ä»¶è®¾è®¡

### 1. å…±äº«æ•°æ®æ¨¡å‹

#### åŸºç¡€æ¨¡å‹æŠ½è±¡
```dart
// åŸºç¡€å®ä½“æ¨¡å‹
abstract class BaseEntity {
  final String id;
  final DateTime createdAt;
  final DateTime updatedAt;
  
  BaseEntity({
    required this.id,
    required this.createdAt,
    required this.updatedAt,
  });
  
  Map<String, dynamic> toJson();
  factory BaseEntity.fromJson(Map<String, dynamic> json);
}

// åŸºç¡€ç”¨æˆ·æ¨¡å‹
abstract class BaseUser extends BaseEntity {
  final String email;
  final String? phone;
  final String displayName;
  final String? avatar;
  final String status; // 'active', 'inactive', 'suspended'
  
  BaseUser({
    required super.id,
    required this.email,
    this.phone,
    required this.displayName,
    this.avatar,
    required this.status,
    required super.createdAt,
    required super.updatedAt,
  });
}

// åŸºç¡€è®¢å•æ¨¡å‹
abstract class BaseOrder extends BaseEntity {
  final String customerId;
  final String providerId;
  final String serviceId;
  final String status; // 'pending', 'accepted', 'in_progress', 'completed', 'cancelled'
  final double amount;
  final DateTime scheduledDate;
  final String? notes;
  
  BaseOrder({
    required super.id,
    required this.customerId,
    required this.providerId,
    required this.serviceId,
    required this.status,
    required this.amount,
    required this.scheduledDate,
    this.notes,
    required super.createdAt,
    required super.updatedAt,
  });
}

// åŸºç¡€æœåŠ¡æ¨¡å‹
abstract class BaseService extends BaseEntity {
  final String providerId;
  final String name;
  final String description;
  final String category;
  final double price;
  final String priceType; // 'fixed', 'hourly', 'negotiable'
  final bool isAvailable;
  
  BaseService({
    required super.id,
    required this.providerId,
    required this.name,
    required this.description,
    required this.category,
    required this.price,
    required this.priceType,
    required this.isAvailable,
    required super.createdAt,
    required super.updatedAt,
  });
}
```

#### å…·ä½“å®ç°æ¨¡å‹
```dart
// Providerç”¨æˆ·æ¨¡å‹
class ProviderUser extends BaseUser {
  final String businessName;
  final String? businessDescription;
  final String? businessAddress;
  final List<String> serviceCategories;
  final List<String> serviceAreas;
  final double averageRating;
  final int totalReviews;
  final int totalOrders;
  final double totalIncome;
  final String verificationStatus; // 'pending', 'verified', 'rejected'
  
  ProviderUser({
    required super.id,
    required super.email,
    super.phone,
    required super.displayName,
    super.avatar,
    required super.status,
    required this.businessName,
    this.businessDescription,
    this.businessAddress,
    required this.serviceCategories,
    required this.serviceAreas,
    this.averageRating = 0.0,
    this.totalReviews = 0,
    this.totalOrders = 0,
    this.totalIncome = 0.0,
    this.verificationStatus = 'pending',
    required super.createdAt,
    required super.updatedAt,
  });
  
  @override
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'email': email,
      'phone': phone,
      'display_name': displayName,
      'avatar': avatar,
      'status': status,
      'business_name': businessName,
      'business_description': businessDescription,
      'business_address': businessAddress,
      'service_categories': serviceCategories,
      'service_areas': serviceAreas,
      'average_rating': averageRating,
      'total_reviews': totalReviews,
      'total_orders': totalOrders,
      'total_income': totalIncome,
      'verification_status': verificationStatus,
      'created_at': createdAt.toIso8601String(),
      'updated_at': updatedAt.toIso8601String(),
    };
  }
  
  factory ProviderUser.fromJson(Map<String, dynamic> json) {
    return ProviderUser(
      id: json['id'],
      email: json['email'],
      phone: json['phone'],
      displayName: json['display_name'],
      avatar: json['avatar'],
      status: json['status'],
      businessName: json['business_name'],
      businessDescription: json['business_description'],
      businessAddress: json['business_address'],
      serviceCategories: List<String>.from(json['service_categories'] ?? []),
      serviceAreas: List<String>.from(json['service_areas'] ?? []),
      averageRating: (json['average_rating'] ?? 0.0).toDouble(),
      totalReviews: json['total_reviews'] ?? 0,
      totalOrders: json['total_orders'] ?? 0,
      totalIncome: (json['total_income'] ?? 0.0).toDouble(),
      verificationStatus: json['verification_status'] ?? 'pending',
      createdAt: DateTime.parse(json['created_at']),
      updatedAt: DateTime.parse(json['updated_at']),
    );
  }
}

// Customerç”¨æˆ·æ¨¡å‹
class CustomerUser extends BaseUser {
  final String? defaultAddress;
  final List<String> preferredCategories;
  final double totalSpent;
  final int totalOrders;
  final double averageRating;
  
  CustomerUser({
    required super.id,
    required super.email,
    super.phone,
    required super.displayName,
    super.avatar,
    required super.status,
    this.defaultAddress,
    this.preferredCategories = const [],
    this.totalSpent = 0.0,
    this.totalOrders = 0,
    this.averageRating = 0.0,
    required super.createdAt,
    required super.updatedAt,
  });
  
  @override
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'email': email,
      'phone': phone,
      'display_name': displayName,
      'avatar': avatar,
      'status': status,
      'default_address': defaultAddress,
      'preferred_categories': preferredCategories,
      'total_spent': totalSpent,
      'total_orders': totalOrders,
      'average_rating': averageRating,
      'created_at': createdAt.toIso8601String(),
      'updated_at': updatedAt.toIso8601String(),
    };
  }
  
  factory CustomerUser.fromJson(Map<String, dynamic> json) {
    return CustomerUser(
      id: json['id'],
      email: json['email'],
      phone: json['phone'],
      displayName: json['display_name'],
      avatar: json['avatar'],
      status: json['status'],
      defaultAddress: json['default_address'],
      preferredCategories: List<String>.from(json['preferred_categories'] ?? []),
      totalSpent: (json['total_spent'] ?? 0.0).toDouble(),
      totalOrders: json['total_orders'] ?? 0,
      averageRating: (json['average_rating'] ?? 0.0).toDouble(),
      createdAt: DateTime.parse(json['created_at']),
      updatedAt: DateTime.parse(json['updated_at']),
    );
  }
}
```

### 2. å…±äº«æœåŠ¡

#### åŸºç¡€APIæœåŠ¡
```dart
// åŸºç¡€APIæœåŠ¡æŠ½è±¡
abstract class BaseApiService {
  final Dio _dio;
  final String _baseUrl;
  
  BaseApiService(this._dio, this._baseUrl);
  
  // é€šç”¨GETè¯·æ±‚
  Future<T> get<T>(String endpoint, {
    Map<String, dynamic>? queryParameters,
    Options? options,
  });
  
  // é€šç”¨POSTè¯·æ±‚
  Future<T> post<T>(String endpoint, {
    dynamic data,
    Map<String, dynamic>? queryParameters,
    Options? options,
  });
  
  // é€šç”¨PUTè¯·æ±‚
  Future<T> put<T>(String endpoint, {
    dynamic data,
    Map<String, dynamic>? queryParameters,
    Options? options,
  });
  
  // é€šç”¨DELETEè¯·æ±‚
  Future<T> delete<T>(String endpoint, {
    Map<String, dynamic>? queryParameters,
    Options? options,
  });
  
  // é”™è¯¯å¤„ç†
  void handleError(dynamic error);
}

// å…·ä½“APIæœåŠ¡å®ç°
class ApiService extends BaseApiService {
  ApiService(Dio dio, String baseUrl) : super(dio, baseUrl);
  
  @override
  Future<T> get<T>(String endpoint, {
    Map<String, dynamic>? queryParameters,
    Options? options,
  }) async {
    try {
      final response = await _dio.get(
        '$_baseUrl$endpoint',
        queryParameters: queryParameters,
        options: options,
      );
      return response.data as T;
    } catch (e) {
      handleError(e);
      rethrow;
    }
  }
  
  @override
  Future<T> post<T>(String endpoint, {
    dynamic data,
    Map<String, dynamic>? queryParameters,
    Options? options,
  }) async {
    try {
      final response = await _dio.post(
        '$_baseUrl$endpoint',
        data: data,
        queryParameters: queryParameters,
        options: options,
      );
      return response.data as T;
    } catch (e) {
      handleError(e);
      rethrow;
    }
  }
  
  @override
  void handleError(dynamic error) {
    // ç»Ÿä¸€çš„é”™è¯¯å¤„ç†é€»è¾‘
    if (error is DioException) {
      switch (error.type) {
        case DioExceptionType.connectionTimeout:
          throw Exception('è¿æ¥è¶…æ—¶');
        case DioExceptionType.sendTimeout:
          throw Exception('å‘é€è¶…æ—¶');
        case DioExceptionType.receiveTimeout:
          throw Exception('æ¥æ”¶è¶…æ—¶');
        case DioExceptionType.badResponse:
          throw Exception('æœåŠ¡å™¨é”™è¯¯: ${error.response?.statusCode}');
        case DioExceptionType.cancel:
          throw Exception('è¯·æ±‚è¢«å–æ¶ˆ');
        default:
          throw Exception('ç½‘ç»œé”™è¯¯');
      }
    }
    throw Exception('æœªçŸ¥é”™è¯¯: $error');
  }
}
```

#### å…±äº«æ•°æ®åº“æœåŠ¡
```dart
// åŸºç¡€æ•°æ®åº“æœåŠ¡æŠ½è±¡
abstract class BaseDatabaseService {
  final SupabaseClient _supabase;
  
  BaseDatabaseService(this._supabase);
  
  // é€šç”¨æŸ¥è¯¢æ–¹æ³•
  Future<List<Map<String, dynamic>>> query(String table, {
    String? select,
    Map<String, dynamic>? filters,
    String? orderBy,
    int? limit,
    int? offset,
  });
  
  // é€šç”¨æ’å…¥æ–¹æ³•
  Future<Map<String, dynamic>> insert(String table, Map<String, dynamic> data);
  
  // é€šç”¨æ›´æ–°æ–¹æ³•
  Future<void> update(String table, Map<String, dynamic> data, Map<String, dynamic> filters);
  
  // é€šç”¨åˆ é™¤æ–¹æ³•
  Future<void> delete(String table, Map<String, dynamic> filters);
  
  // äº‹åŠ¡å¤„ç†
  Future<T> transaction<T>(Future<T> Function() callback);
}

// å…·ä½“æ•°æ®åº“æœåŠ¡å®ç°
class DatabaseService extends BaseDatabaseService {
  DatabaseService(SupabaseClient supabase) : super(supabase);
  
  @override
  Future<List<Map<String, dynamic>>> query(String table, {
    String? select,
    Map<String, dynamic>? filters,
    String? orderBy,
    int? limit,
    int? offset,
  }) async {
    try {
      var query = _supabase.from(table).select(select ?? '*');
      
      if (filters != null) {
        filters.forEach((key, value) {
          if (value is List) {
            query = query.inFilter(key, value);
          } else {
            query = query.eq(key, value);
          }
        });
      }
      
      if (orderBy != null) {
        query = query.order(orderBy);
      }
      
      if (limit != null) {
        query = query.limit(limit);
      }
      
      if (offset != null) {
        query = query.range(offset, offset + (limit ?? 50) - 1);
      }
      
      final response = await query;
      return List<Map<String, dynamic>>.from(response);
    } catch (e) {
      throw Exception('æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: $e');
    }
  }
  
  @override
  Future<Map<String, dynamic>> insert(String table, Map<String, dynamic> data) async {
    try {
      final response = await _supabase.from(table).insert(data).select().single();
      return response;
    } catch (e) {
      throw Exception('æ•°æ®åº“æ’å…¥å¤±è´¥: $e');
    }
  }
  
  @override
  Future<void> update(String table, Map<String, dynamic> data, Map<String, dynamic> filters) async {
    try {
      var query = _supabase.from(table).update(data);
      
      filters.forEach((key, value) {
        query = query.eq(key, value);
      });
      
      await query;
    } catch (e) {
      throw Exception('æ•°æ®åº“æ›´æ–°å¤±è´¥: $e');
    }
  }
  
  @override
  Future<void> delete(String table, Map<String, dynamic> filters) async {
    try {
      var query = _supabase.from(table).delete();
      
      filters.forEach((key, value) {
        query = query.eq(key, value);
      });
      
      await query;
    } catch (e) {
      throw Exception('æ•°æ®åº“åˆ é™¤å¤±è´¥: $e');
    }
  }
  
  @override
  Future<T> transaction<T>(Future<T> Function() callback) async {
    // Supabaseä¸æ”¯æŒä¼ ç»Ÿäº‹åŠ¡ï¼Œè¿™é‡Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„äº‹åŠ¡é€»è¾‘
    try {
      return await callback();
    } catch (e) {
      throw Exception('äº‹åŠ¡æ‰§è¡Œå¤±è´¥: $e');
    }
  }
}
```

### 3. å…±äº«å·¥å…·ç±»

#### éªŒè¯å™¨
```dart
// åŸºç¡€éªŒè¯å™¨
abstract class BaseValidator {
  static bool isValidEmail(String email) {
    return RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$').hasMatch(email);
  }
  
  static bool isValidPhone(String phone) {
    return RegExp(r'^\+?[\d\s-()]{10,}$').hasMatch(phone);
  }
  
  static bool isValidPassword(String password) {
    return password.length >= 8;
  }
  
  static bool isValidName(String name) {
    return name.trim().length >= 2;
  }
  
  static bool isValidPrice(double price) {
    return price >= 0;
  }
  
  static bool isValidDate(DateTime date) {
    return date.isAfter(DateTime.now().subtract(Duration(days: 365 * 100)));
  }
}

// æ‰©å±•éªŒè¯å™¨
class ExtendedValidator extends BaseValidator {
  static bool isValidBusinessName(String name) {
    return name.trim().length >= 3 && name.trim().length <= 100;
  }
  
  static bool isValidServiceDescription(String description) {
    return description.trim().length >= 10 && description.trim().length <= 1000;
  }
  
  static bool isValidAddress(String address) {
    return address.trim().length >= 10;
  }
  
  static bool isValidRating(double rating) {
    return rating >= 0 && rating <= 5;
  }
}
```

#### æ ¼å¼åŒ–å™¨
```dart
// åŸºç¡€æ ¼å¼åŒ–å™¨
abstract class BaseFormatter {
  static String formatCurrency(double amount, {String currency = 'USD'}) {
    return '\$${amount.toStringAsFixed(2)}';
  }
  
  static String formatDate(DateTime date) {
    return '${date.year}-${date.month.toString().padLeft(2, '0')}-${date.day.toString().padLeft(2, '0')}';
  }
  
  static String formatDateTime(DateTime dateTime) {
    return '${formatDate(dateTime)} ${dateTime.hour.toString().padLeft(2, '0')}:${dateTime.minute.toString().padLeft(2, '0')}';
  }
  
  static String formatPhone(String phone) {
    if (phone.length == 11) {
      return '${phone.substring(0, 3)}-${phone.substring(3, 7)}-${phone.substring(7)}';
    }
    return phone;
  }
  
  static String formatDuration(int minutes) {
    if (minutes < 60) {
      return '${minutes}åˆ†é’Ÿ';
    } else {
      final hours = minutes ~/ 60;
      final remainingMinutes = minutes % 60;
      if (remainingMinutes == 0) {
        return '${hours}å°æ—¶';
      } else {
        return '${hours}å°æ—¶${remainingMinutes}åˆ†é’Ÿ';
      }
    }
  }
  
  static String formatFileSize(int bytes) {
    if (bytes < 1024) {
      return '${bytes}B';
    } else if (bytes < 1024 * 1024) {
      return '${(bytes / 1024).toStringAsFixed(1)}KB';
    } else if (bytes < 1024 * 1024 * 1024) {
      return '${(bytes / (1024 * 1024)).toStringAsFixed(1)}MB';
    } else {
      return '${(bytes / (1024 * 1024 * 1024)).toStringAsFixed(1)}GB';
    }
  }
}

// æ‰©å±•æ ¼å¼åŒ–å™¨
class ExtendedFormatter extends BaseFormatter {
  static String formatOrderStatus(String status) {
    switch (status) {
      case 'pending':
        return 'å¾…å¤„ç†';
      case 'accepted':
        return 'å·²æ¥å—';
      case 'in_progress':
        return 'è¿›è¡Œä¸­';
      case 'completed':
        return 'å·²å®Œæˆ';
      case 'cancelled':
        return 'å·²å–æ¶ˆ';
      default:
        return 'æœªçŸ¥çŠ¶æ€';
    }
  }
  
  static String formatUserStatus(String status) {
    switch (status) {
      case 'active':
        return 'æ´»è·ƒ';
      case 'inactive':
        return 'ä¸æ´»è·ƒ';
      case 'suspended':
        return 'å·²æš‚åœ';
      default:
        return 'æœªçŸ¥çŠ¶æ€';
    }
  }
  
  static String formatRating(double rating) {
    return '${rating.toStringAsFixed(1)}/5.0';
  }
}
```

## ğŸ”Œ æ’ä»¶å¼€å‘è§„èŒƒ

### 1. æ’ä»¶ç»“æ„
```
lib/plugins/
â”œâ”€â”€ plugin_name/
â”‚   â”œâ”€â”€ models/              # æ’ä»¶ç‰¹å®šæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ plugin_model.dart
â”‚   â”‚   â””â”€â”€ plugin_model.g.dart
â”‚   â”œâ”€â”€ services/            # æ’ä»¶ç‰¹å®šæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ plugin_service.dart
â”‚   â”‚   â””â”€â”€ plugin_api_service.dart
â”‚   â”œâ”€â”€ controllers/         # æ’ä»¶æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ plugin_controller.dart
â”‚   â”œâ”€â”€ views/               # æ’ä»¶è§†å›¾
â”‚   â”‚   â”œâ”€â”€ plugin_page.dart
â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”œâ”€â”€ bindings/            # æ’ä»¶ç»‘å®š
â”‚   â”‚   â””â”€â”€ plugin_binding.dart
â”‚   â”œâ”€â”€ routes/              # æ’ä»¶è·¯ç”±
â”‚   â”‚   â””â”€â”€ plugin_routes.dart
â”‚   â””â”€â”€ plugin.dart          # æ’ä»¶å…¥å£
```

### 2. æ’ä»¶æ¥å£
```dart
// æ’ä»¶æ¥å£å®šä¹‰
abstract class IPlugin {
  String get name;
  String get version;
  String get description;
  List<String> get dependencies;
  
  Future<void> initialize();
  Future<void> dispose();
  
  List<GetPage> get routes;
  List<Bindings> get bindings;
}

// æ’ä»¶åŸºç±»
abstract class BasePlugin implements IPlugin {
  @override
  Future<void> initialize() async {
    // åŸºç¡€åˆå§‹åŒ–é€»è¾‘
    await _registerBindings();
    await _registerRoutes();
    await _initializeServices();
  }
  
  @override
  Future<void> dispose() async {
    // åŸºç¡€æ¸…ç†é€»è¾‘
    await _disposeServices();
    await _unregisterBindings();
  }
  
  Future<void> _registerBindings();
  Future<void> _registerRoutes();
  Future<void> _initializeServices();
  Future<void> _disposeServices();
  Future<void> _unregisterBindings();
}

// å…·ä½“æ’ä»¶å®ç°
class OrderManagementPlugin extends BasePlugin {
  @override
  String get name => 'order_management';
  
  @override
  String get version => '1.0.0';
  
  @override
  String get description => 'è®¢å•ç®¡ç†æ’ä»¶';
  
  @override
  List<String> get dependencies => ['auth', 'database'];
  
  @override
  List<GetPage> get routes => [
    GetPage(
      name: '/orders',
      page: () => OrderPage(),
      binding: OrderBinding(),
    ),
    GetPage(
      name: '/order/:id',
      page: () => OrderDetailPage(),
      binding: OrderDetailBinding(),
    ),
  ];
  
  @override
  List<Bindings> get bindings => [
    OrderBinding(),
    OrderDetailBinding(),
  ];
  
  @override
  Future<void> _registerBindings() async {
    // æ³¨å†Œè®¢å•ç®¡ç†ç›¸å…³çš„ä¾èµ–æ³¨å…¥
  }
  
  @override
  Future<void> _registerRoutes() async {
    // æ³¨å†Œè®¢å•ç®¡ç†ç›¸å…³çš„è·¯ç”±
  }
  
  @override
  Future<void> _initializeServices() async {
    // åˆå§‹åŒ–è®¢å•ç®¡ç†ç›¸å…³çš„æœåŠ¡
  }
  
  @override
  Future<void> _disposeServices() async {
    // æ¸…ç†è®¢å•ç®¡ç†ç›¸å…³çš„æœåŠ¡
  }
  
  @override
  Future<void> _unregisterBindings() async {
    // æ³¨é”€è®¢å•ç®¡ç†ç›¸å…³çš„ä¾èµ–æ³¨å…¥
  }
}
```

### 3. æ’ä»¶ç®¡ç†å™¨
```dart
// æ’ä»¶ç®¡ç†å™¨
class PluginManager {
  static final PluginManager _instance = PluginManager._internal();
  factory PluginManager() => _instance;
  PluginManager._internal();
  
  final Map<String, IPlugin> _plugins = {};
  final Map<String, bool> _pluginStates = {};
  
  // æ³¨å†Œæ’ä»¶
  Future<void> registerPlugin(IPlugin plugin) async {
    if (_plugins.containsKey(plugin.name)) {
      throw Exception('æ’ä»¶ ${plugin.name} å·²å­˜åœ¨');
    }
    
    // æ£€æŸ¥ä¾èµ–
    await _checkDependencies(plugin);
    
    // æ³¨å†Œæ’ä»¶
    _plugins[plugin.name] = plugin;
    _pluginStates[plugin.name] = false;
    
    print('æ’ä»¶ ${plugin.name} æ³¨å†ŒæˆåŠŸ');
  }
  
  // åˆå§‹åŒ–æ’ä»¶
  Future<void> initializePlugin(String pluginName) async {
    final plugin = _plugins[pluginName];
    if (plugin == null) {
      throw Exception('æ’ä»¶ $pluginName ä¸å­˜åœ¨');
    }
    
    if (_pluginStates[pluginName] == true) {
      print('æ’ä»¶ $pluginName å·²ç»åˆå§‹åŒ–');
      return;
    }
    
    try {
      await plugin.initialize();
      _pluginStates[pluginName] = true;
      print('æ’ä»¶ $pluginName åˆå§‹åŒ–æˆåŠŸ');
    } catch (e) {
      print('æ’ä»¶ $pluginName åˆå§‹åŒ–å¤±è´¥: $e');
      rethrow;
    }
  }
  
  // åˆå§‹åŒ–æ‰€æœ‰æ’ä»¶
  Future<void> initializeAllPlugins() async {
    for (final plugin in _plugins.values) {
      await initializePlugin(plugin.name);
    }
  }
  
  // ç¦ç”¨æ’ä»¶
  Future<void> disablePlugin(String pluginName) async {
    final plugin = _plugins[pluginName];
    if (plugin == null) {
      throw Exception('æ’ä»¶ $pluginName ä¸å­˜åœ¨');
    }
    
    if (_pluginStates[pluginName] == false) {
      print('æ’ä»¶ $pluginName å·²ç»ç¦ç”¨');
      return;
    }
    
    try {
      await plugin.dispose();
      _pluginStates[pluginName] = false;
      print('æ’ä»¶ $pluginName ç¦ç”¨æˆåŠŸ');
    } catch (e) {
      print('æ’ä»¶ $pluginName ç¦ç”¨å¤±è´¥: $e');
      rethrow;
    }
  }
  
  // è·å–æ’ä»¶
  IPlugin? getPlugin(String pluginName) {
    return _plugins[pluginName];
  }
  
  // è·å–æ‰€æœ‰æ’ä»¶
  List<IPlugin> getAllPlugins() {
    return _plugins.values.toList();
  }
  
  // è·å–å·²å¯ç”¨çš„æ’ä»¶
  List<IPlugin> getEnabledPlugins() {
    return _plugins.entries
        .where((entry) => _pluginStates[entry.key] == true)
        .map((entry) => entry.value)
        .toList();
  }
  
  // æ£€æŸ¥ä¾èµ–
  Future<void> _checkDependencies(IPlugin plugin) async {
    for (final dependency in plugin.dependencies) {
      if (!_plugins.containsKey(dependency)) {
        throw Exception('æ’ä»¶ ${plugin.name} ä¾èµ–çš„æ’ä»¶ $dependency ä¸å­˜åœ¨');
      }
    }
  }
}
```

## ğŸ”„ äº‹ä»¶ç³»ç»Ÿ

### 1. äº‹ä»¶æ€»çº¿
```dart
// äº‹ä»¶æ€»çº¿
class EventBus {
  static final EventBus _instance = EventBus._internal();
  factory EventBus() => _instance;
  EventBus._internal();
  
  final Map<String, List<Function>> _listeners = {};
  
  // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
  void on(String event, Function callback) {
    if (!_listeners.containsKey(event)) {
      _listeners[event] = [];
    }
    _listeners[event]!.add(callback);
  }
  
  // æ³¨é”€äº‹ä»¶ç›‘å¬å™¨
  void off(String event, Function callback) {
    if (_listeners.containsKey(event)) {
      _listeners[event]!.remove(callback);
    }
  }
  
  // è§¦å‘äº‹ä»¶
  void emit(String event, [dynamic data]) {
    if (_listeners.containsKey(event)) {
      for (final callback in _listeners[event]!) {
        callback(data);
      }
    }
  }
  
  // æ¸…é™¤æ‰€æœ‰ç›‘å¬å™¨
  void clear() {
    _listeners.clear();
  }
}

// äº‹ä»¶å®šä¹‰
class AppEvents {
  static const String userLogin = 'user_login';
  static const String userLogout = 'user_logout';
  static const String orderCreated = 'order_created';
  static const String orderUpdated = 'order_updated';
  static const String orderCompleted = 'order_completed';
  static const String notificationReceived = 'notification_received';
  static const String networkStatusChanged = 'network_status_changed';
}
```

### 2. äº‹ä»¶ä½¿ç”¨ç¤ºä¾‹
```dart
// åœ¨æ’ä»¶ä¸­ç›‘å¬äº‹ä»¶
class OrderManagementPlugin extends BasePlugin {
  @override
  Future<void> _initializeServices() async {
    // ç›‘å¬è®¢å•ç›¸å…³äº‹ä»¶
    EventBus().on(AppEvents.orderCreated, _handleOrderCreated);
    EventBus().on(AppEvents.orderUpdated, _handleOrderUpdated);
    EventBus().on(AppEvents.orderCompleted, _handleOrderCompleted);
  }
  
  void _handleOrderCreated(dynamic data) {
    // å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶
    print('è®¢å•åˆ›å»º: $data');
  }
  
  void _handleOrderUpdated(dynamic data) {
    // å¤„ç†è®¢å•æ›´æ–°äº‹ä»¶
    print('è®¢å•æ›´æ–°: $data');
  }
  
  void _handleOrderCompleted(dynamic data) {
    // å¤„ç†è®¢å•å®Œæˆäº‹ä»¶
    print('è®¢å•å®Œæˆ: $data');
  }
  
  @override
  Future<void> _disposeServices() async {
    // æ³¨é”€äº‹ä»¶ç›‘å¬
    EventBus().off(AppEvents.orderCreated, _handleOrderCreated);
    EventBus().off(AppEvents.orderUpdated, _handleOrderUpdated);
    EventBus().off(AppEvents.orderCompleted, _handleOrderCompleted);
  }
}

// åœ¨æœåŠ¡ä¸­è§¦å‘äº‹ä»¶
class OrderService {
  Future<void> createOrder(Order order) async {
    // åˆ›å»ºè®¢å•é€»è¾‘
    await _saveOrder(order);
    
    // è§¦å‘è®¢å•åˆ›å»ºäº‹ä»¶
    EventBus().emit(AppEvents.orderCreated, order);
  }
  
  Future<void> updateOrder(Order order) async {
    // æ›´æ–°è®¢å•é€»è¾‘
    await _updateOrder(order);
    
    // è§¦å‘è®¢å•æ›´æ–°äº‹ä»¶
    EventBus().emit(AppEvents.orderUpdated, order);
  }
}
```

## ğŸ“‹ å¼€å‘æŒ‡å—

### 1. åˆ›å»ºæ–°æ’ä»¶
1. åœ¨ `lib/plugins/` ç›®å½•ä¸‹åˆ›å»ºæ’ä»¶ç›®å½•
2. å®ç° `IPlugin` æ¥å£æˆ–ç»§æ‰¿ `BasePlugin`
3. å®šä¹‰æ’ä»¶ç‰¹å®šçš„æ¨¡å‹ã€æœåŠ¡ã€æ§åˆ¶å™¨
4. æ³¨å†Œè·¯ç”±å’Œä¾èµ–æ³¨å…¥
5. åœ¨åº”ç”¨å¯åŠ¨æ—¶æ³¨å†Œæ’ä»¶

### 2. ä½¿ç”¨å…±äº«ç»„ä»¶
1. å¯¼å…¥å…±äº«ç»„ä»¶åº“
2. ç»§æ‰¿åŸºç¡€æ¨¡å‹æˆ–ä½¿ç”¨åŸºç¡€æœåŠ¡
3. å¤ç”¨éªŒè¯å™¨å’Œæ ¼å¼åŒ–å™¨
4. ä½¿ç”¨äº‹ä»¶æ€»çº¿è¿›è¡Œæ¨¡å—é—´é€šä¿¡

### 3. æµ‹è¯•æ’ä»¶
1. ä¸ºæ¯ä¸ªæ’ä»¶ç¼–å†™å•å…ƒæµ‹è¯•
2. æµ‹è¯•æ’ä»¶é—´çš„é›†æˆ
3. æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ
4. æµ‹è¯•ä¾èµ–æ³¨å…¥

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ
**ç»´æŠ¤è€…**: æ¶æ„è®¾è®¡å›¢é˜Ÿ 
# å¹³å°çº§ç³»ç»Ÿç»„ä»¶æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°äº†å°†éª¨æ¶å±ã€æ¸è¿›å¼åŠ è½½ã€ç¦»çº¿æ”¯æŒå’Œé”™è¯¯æ¢å¤æœºåˆ¶ç­‰æŠ€æœ¯ä¸Šå‡åˆ°å¹³å°çº§ç³»ç»Ÿç»„ä»¶çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ—¨åœ¨æä¾›ç»Ÿä¸€ã€å¯å¤ç”¨ã€é«˜æ€§èƒ½çš„ç”¨æˆ·ä½“éªŒè§£å†³æ–¹æ¡ˆã€‚

> **ğŸ“ æ–‡æ¡£è¯´æ˜**
> 
> æœ¬æ–‡æ¡£ä¸“æ³¨äº**æŠ€æœ¯æ¶æ„è®¾è®¡**å’Œ**ç³»ç»Ÿç»„ä»¶è®¾è®¡**ï¼Œä¸ºå¼€å‘è€…æä¾›å¹³å°çº§ç»„ä»¶çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆã€‚
> 
> **ç›¸å…³æ–‡æ¡£**ï¼š
> - **[PLATFORM_COMPONENTS_COMPLETE_GUIDE.md](../provider/PLATFORM_COMPONENTS_COMPLETE_GUIDE.md)** - å¹³å°ç»„ä»¶å®Œæ•´å®æ–½æŒ‡å—ï¼ˆåŒ…å«å®æ–½æ­¥éª¤ã€å¸¸è§é—®é¢˜ã€æ£€æŸ¥æ¸…å•ç­‰ï¼‰
> 
> **æ–‡æ¡£åˆ†å·¥**ï¼š
> - æœ¬æ–‡æ¡£ï¼šæŠ€æœ¯æ¶æ„è®¾è®¡ã€ç»„ä»¶è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§æŒ‡æ ‡
> - å®æ–½æŒ‡å—ï¼šå®é™…å®æ–½ã€é›†æˆæ­¥éª¤ã€é—®é¢˜è§£å†³ã€æœ€ä½³å®è·µ

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒåŸåˆ™
- **ç»Ÿä¸€æ€§**ï¼šè·¨æ¨¡å—ã€è·¨åŠŸèƒ½çš„ä¸€è‡´æ€§ä½“éªŒ
- **å¯å¤ç”¨æ€§**ï¼šä¸€æ¬¡å¼€å‘ï¼Œå¤šå¤„ä½¿ç”¨
- **é«˜æ€§èƒ½**ï¼šæœ€å°åŒ–æ€§èƒ½å¼€é”€ï¼Œæœ€å¤§åŒ–ç”¨æˆ·ä½“éªŒ
- **å¯é…ç½®æ€§**ï¼šçµæ´»é…ç½®ï¼Œé€‚åº”ä¸åŒä¸šåŠ¡åœºæ™¯
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ‰©å±•å’Œç»´æŠ¤

### æŠ€æœ¯ç›®æ ‡
- **åŠ è½½æ—¶é—´å‡å°‘50%**ï¼šé€šè¿‡éª¨æ¶å±å’Œæ¸è¿›å¼åŠ è½½
- **ç¦»çº¿å¯ç”¨æ€§æå‡80%**ï¼šé€šè¿‡ç¦»çº¿æ”¯æŒå’Œç¼“å­˜ç­–ç•¥
- **é”™è¯¯æ¢å¤ç‡æå‡90%**ï¼šé€šè¿‡æ™ºèƒ½é”™è¯¯æ¢å¤æœºåˆ¶
- **å¼€å‘æ•ˆç‡æå‡60%**ï¼šé€šè¿‡å¹³å°çº§ç»„ä»¶å¤ç”¨

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¹³å°çº§ç³»ç»Ÿç»„ä»¶å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   éª¨æ¶å±    â”‚ â”‚ æ¸è¿›å¼åŠ è½½  â”‚ â”‚  ç¦»çº¿æ”¯æŒ   â”‚ â”‚é”™è¯¯æ¢å¤ â”‚ â”‚
â”‚  â”‚  Skeleton   â”‚ â”‚ Progressive â”‚ â”‚   Offline   â”‚ â”‚ Recoveryâ”‚ â”‚
â”‚  â”‚   System    â”‚ â”‚   Loading   â”‚ â”‚   Support   â”‚ â”‚ System  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ ¸å¿ƒæœåŠ¡å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç¼“å­˜ç®¡ç†  â”‚ â”‚  ç½‘ç»œç®¡ç†   â”‚ â”‚  çŠ¶æ€ç®¡ç†   â”‚ â”‚ ç›‘æ§ç³»ç»Ÿ â”‚ â”‚
â”‚  â”‚Cache Managerâ”‚ â”‚Network Mgr  â”‚ â”‚State Managerâ”‚ â”‚ Monitor â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡æ¨¡å—å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç”¨æˆ·æ¨¡å—  â”‚ â”‚  æœåŠ¡æ¨¡å—   â”‚ â”‚  è®¢å•æ¨¡å—   â”‚ â”‚ å…¶ä»–æ¨¡å—â”‚ â”‚
â”‚  â”‚User Module  â”‚ â”‚Service Mod  â”‚ â”‚Order Module â”‚ â”‚Other Modâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶å…³ç³»å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PlatformCore  â”‚
                    â”‚   (å¹³å°æ ¸å¿ƒ)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Skeletonâ”‚          â”‚Progressiveâ”‚          â”‚  Offline â”‚
    â”‚System  â”‚          â”‚  Loading  â”‚          â”‚  Support â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Skeletonâ”‚          â”‚Loading   â”‚          â”‚Offline   â”‚
    â”‚Widget  â”‚          â”‚Manager   â”‚          â”‚Manager   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. éª¨æ¶å±ç³»ç»Ÿ (Skeleton System)

#### 1.1 æ¶æ„è®¾è®¡

```dart
// å¹³å°çº§éª¨æ¶å±ç³»ç»Ÿ
abstract class PlatformSkeleton {
  /// éª¨æ¶å±é…ç½®
  static const SkeletonConfig defaultConfig = SkeletonConfig(
    animationDuration: Duration(milliseconds: 1500),
    shimmerColor: Color(0xFFE0E0E0),
    baseColor: Color(0xFFF5F5F5),
    borderRadius: 8.0,
  );

  /// åˆ›å»ºéª¨æ¶å±ç»„ä»¶
  static Widget create({
    required SkeletonType type,
    SkeletonConfig? config,
    Map<String, dynamic>? customData,
  }) {
    final skeletonConfig = config ?? defaultConfig;
    
    switch (type) {
      case SkeletonType.list:
        return SkeletonListWidget(config: skeletonConfig);
      case SkeletonType.card:
        return SkeletonCardWidget(config: skeletonConfig);
      case SkeletonType.detail:
        return SkeletonDetailWidget(config: skeletonConfig);
      case SkeletonType.custom:
        return SkeletonCustomWidget(
          config: skeletonConfig,
          customData: customData,
        );
    }
  }
}

/// éª¨æ¶å±ç±»å‹æšä¸¾
enum SkeletonType {
  list,    // åˆ—è¡¨éª¨æ¶å±
  card,    // å¡ç‰‡éª¨æ¶å±
  detail,  // è¯¦æƒ…é¡µéª¨æ¶å±
  custom,  // è‡ªå®šä¹‰éª¨æ¶å±
}

/// éª¨æ¶å±é…ç½®
class SkeletonConfig {
  final Duration animationDuration;
  final Color shimmerColor;
  final Color baseColor;
  final double borderRadius;
  
  const SkeletonConfig({
    required this.animationDuration,
    required this.shimmerColor,
    required this.baseColor,
    required this.borderRadius,
  });
}
```

#### 1.2 å®ç°ç¤ºä¾‹

```dart
// åˆ—è¡¨éª¨æ¶å±ç»„ä»¶
class SkeletonListWidget extends StatefulWidget {
  final SkeletonConfig config;
  
  const SkeletonListWidget({
    Key? key,
    required this.config,
  }) : super(key: key);

  @override
  State<SkeletonListWidget> createState() => _SkeletonListWidgetState();
}

class _SkeletonListWidgetState extends State<SkeletonListWidget>
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _animation;

  @override
  void initState() {
    super.initState();
    _animationController = AnimationController(
      duration: widget.config.animationDuration,
      vsync: this,
    );
    _animation = Tween<double>(begin: 0.0, end: 1.0).animate(
      CurvedAnimation(parent: _animationController, curve: Curves.easeInOut),
    );
    _animationController.repeat();
  }

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: 10,
      itemBuilder: (context, index) {
        return AnimatedBuilder(
          animation: _animation,
          builder: (context, child) {
            return Container(
              margin: const EdgeInsets.symmetric(vertical: 8, horizontal: 16),
              padding: const EdgeInsets.all(16),
              decoration: BoxDecoration(
                color: widget.config.baseColor,
                borderRadius: BorderRadius.circular(widget.config.borderRadius),
              ),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // æ ‡é¢˜éª¨æ¶
                  Container(
                    height: 20,
                    width: double.infinity,
                    decoration: BoxDecoration(
                      color: _getShimmerColor(),
                      borderRadius: BorderRadius.circular(4),
                    ),
                  ),
                  const SizedBox(height: 8),
                  // å†…å®¹éª¨æ¶
                  Container(
                    height: 16,
                    width: MediaQuery.of(context).size.width * 0.7,
                    decoration: BoxDecoration(
                      color: _getShimmerColor(),
                      borderRadius: BorderRadius.circular(4),
                    ),
                  ),
                ],
              ),
            );
          },
        );
      },
    );
  }

  Color _getShimmerColor() {
    return Color.lerp(
      widget.config.baseColor,
      widget.config.shimmerColor,
      _animation.value,
    )!;
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }
}
```

### 2. æ¸è¿›å¼åŠ è½½ç³»ç»Ÿ (Progressive Loading System)

#### 2.1 æ¶æ„è®¾è®¡

```dart
// å¹³å°çº§æ¸è¿›å¼åŠ è½½ç³»ç»Ÿ
class PlatformProgressiveLoading {
  /// æ¸è¿›å¼åŠ è½½é…ç½®
  static const ProgressiveConfig defaultConfig = ProgressiveConfig(
    initialLoadDelay: Duration(milliseconds: 300),
    progressiveDelay: Duration(milliseconds: 200),
    maxRetries: 3,
    retryDelay: Duration(seconds: 2),
  );

  /// åˆ›å»ºæ¸è¿›å¼åŠ è½½ç»„ä»¶
  static Widget create({
    required ProgressiveType type,
    ProgressiveConfig? config,
    required Future<void> Function() loadFunction,
    required Widget Function(BuildContext) contentBuilder,
    Widget? loadingWidget,
    Widget? errorWidget,
  }) {
    return ProgressiveLoadingWidget(
      type: type,
      config: config ?? defaultConfig,
      loadFunction: loadFunction,
      contentBuilder: contentBuilder,
      loadingWidget: loadingWidget,
      errorWidget: errorWidget,
    );
  }
}

/// æ¸è¿›å¼åŠ è½½ç±»å‹
enum ProgressiveType {
  sequential,  // é¡ºåºåŠ è½½
  parallel,    // å¹¶è¡ŒåŠ è½½
  priority,    // ä¼˜å…ˆçº§åŠ è½½
  lazy,        // æ‡’åŠ è½½
}

/// æ¸è¿›å¼åŠ è½½é…ç½®
class ProgressiveConfig {
  final Duration initialLoadDelay;
  final Duration progressiveDelay;
  final int maxRetries;
  final Duration retryDelay;
  
  const ProgressiveConfig({
    required this.initialLoadDelay,
    required this.progressiveDelay,
    required this.maxRetries,
    required this.retryDelay,
  });
}
```

#### 2.2 å®ç°ç¤ºä¾‹

```dart
// æ¸è¿›å¼åŠ è½½ç»„ä»¶
class ProgressiveLoadingWidget extends StatefulWidget {
  final ProgressiveType type;
  final ProgressiveConfig config;
  final Future<void> Function() loadFunction;
  final Widget Function(BuildContext) contentBuilder;
  final Widget? loadingWidget;
  final Widget? errorWidget;

  const ProgressiveLoadingWidget({
    Key? key,
    required this.type,
    required this.config,
    required this.loadFunction,
    required this.contentBuilder,
    this.loadingWidget,
    this.errorWidget,
  }) : super(key: key);

  @override
  State<ProgressiveLoadingWidget> createState() => _ProgressiveLoadingWidgetState();
}

class _ProgressiveLoadingWidgetState extends State<ProgressiveLoadingWidget> {
  LoadingState _loadingState = LoadingState.initial;
  int _retryCount = 0;
  String? _errorMessage;

  @override
  void initState() {
    super.initState();
    _startLoading();
  }

  Future<void> _startLoading() async {
    if (_loadingState == LoadingState.loading) return;
    
    setState(() {
      _loadingState = LoadingState.loading;
      _errorMessage = null;
    });

    try {
      // åˆå§‹å»¶è¿Ÿ
      await Future.delayed(widget.config.initialLoadDelay);
      
      // æ‰§è¡ŒåŠ è½½å‡½æ•°
      await widget.loadFunction();
      
      setState(() {
        _loadingState = LoadingState.success;
      });
    } catch (e) {
      _handleError(e);
    }
  }

  void _handleError(dynamic error) {
    if (_retryCount < widget.config.maxRetries) {
      _retryCount++;
      Future.delayed(widget.config.retryDelay, _startLoading);
    } else {
      setState(() {
        _loadingState = LoadingState.error;
        _errorMessage = error.toString();
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    switch (_loadingState) {
      case LoadingState.initial:
      case LoadingState.loading:
        return widget.loadingWidget ?? 
               PlatformSkeleton.create(type: SkeletonType.list);
      
      case LoadingState.success:
        return widget.contentBuilder(context);
      
      case LoadingState.error:
        return widget.errorWidget ?? 
               _buildErrorWidget();
    }
  }

  Widget _buildErrorWidget() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(Icons.error_outline, size: 48, color: Colors.red),
          SizedBox(height: 16),
          Text('åŠ è½½å¤±è´¥', style: TextStyle(fontSize: 16)),
          SizedBox(height: 8),
          Text(_errorMessage ?? 'æœªçŸ¥é”™è¯¯', style: TextStyle(fontSize: 14)),
          SizedBox(height: 16),
          ElevatedButton(
            onPressed: () {
              _retryCount = 0;
              _startLoading();
            },
            child: Text('é‡è¯•'),
          ),
        ],
      ),
    );
  }
}
```

### 3. ç¦»çº¿æ”¯æŒç³»ç»Ÿ (Offline Support System)

#### 3.1 æ¶æ„è®¾è®¡

```dart
// å¹³å°çº§ç¦»çº¿æ”¯æŒç³»ç»Ÿ
class PlatformOfflineSupport {
  /// ç¦»çº¿æ”¯æŒé…ç½®
  static const OfflineConfig defaultConfig = OfflineConfig(
    enableOfflineMode: true,
    cacheExpiration: Duration(days: 7),
    maxCacheSize: 100 * 1024 * 1024, // 100MB
    syncInterval: Duration(minutes: 5),
  );

  /// åˆ›å»ºç¦»çº¿æ”¯æŒç»„ä»¶
  static Widget create({
    required OfflineType type,
    OfflineConfig? config,
    required Widget Function(BuildContext) onlineBuilder,
    required Widget Function(BuildContext) offlineBuilder,
    Widget? syncIndicator,
  }) {
    return OfflineSupportWidget(
      type: type,
      config: config ?? defaultConfig,
      onlineBuilder: onlineBuilder,
      offlineBuilder: offlineBuilder,
      syncIndicator: syncIndicator,
    );
  }
}

/// ç¦»çº¿æ”¯æŒç±»å‹
enum OfflineType {
  cache,      // ç¼“å­˜æ¨¡å¼
  sync,       // åŒæ­¥æ¨¡å¼
  hybrid,     // æ··åˆæ¨¡å¼
  adaptive,   // è‡ªé€‚åº”æ¨¡å¼
}

/// ç¦»çº¿æ”¯æŒé…ç½®
class OfflineConfig {
  final bool enableOfflineMode;
  final Duration cacheExpiration;
  final int maxCacheSize;
  final Duration syncInterval;
  
  const OfflineConfig({
    required this.enableOfflineMode,
    required this.cacheExpiration,
    required this.maxCacheSize,
    required this.syncInterval,
  });
}
```

#### 3.2 å®ç°ç¤ºä¾‹

```dart
// ç¦»çº¿æ”¯æŒç»„ä»¶
class OfflineSupportWidget extends StatefulWidget {
  final OfflineType type;
  final OfflineConfig config;
  final Widget Function(BuildContext) onlineBuilder;
  final Widget Function(BuildContext) offlineBuilder;
  final Widget? syncIndicator;

  const OfflineSupportWidget({
    Key? key,
    required this.type,
    required this.config,
    required this.onlineBuilder,
    required this.offlineBuilder,
    this.syncIndicator,
  }) : super(key: key);

  @override
  State<OfflineSupportWidget> createState() => _OfflineSupportWidgetState();
}

class _OfflineSupportWidgetState extends State<OfflineSupportWidget> {
  bool _isOnline = true;
  bool _isSyncing = false;
  late StreamSubscription<ConnectivityResult> _connectivitySubscription;

  @override
  void initState() {
    super.initState();
    _initializeConnectivity();
    _checkInitialConnectivity();
  }

  Future<void> _initializeConnectivity() async {
    _connectivitySubscription = Connectivity()
        .onConnectivityChanged
        .listen(_onConnectivityChanged);
  }

  Future<void> _checkInitialConnectivity() async {
    final result = await Connectivity().checkConnectivity();
    _onConnectivityChanged(result);
  }

  void _onConnectivityChanged(ConnectivityResult result) {
    final isOnline = result != ConnectivityResult.none;
    
    if (mounted && _isOnline != isOnline) {
      setState(() {
        _isOnline = isOnline;
      });
      
      if (isOnline && widget.type == OfflineType.sync) {
        _startSync();
      }
    }
  }

  Future<void> _startSync() async {
    if (_isSyncing) return;
    
    setState(() {
      _isSyncing = true;
    });

    try {
      // æ‰§è¡ŒåŒæ­¥é€»è¾‘
      await _performSync();
    } finally {
      if (mounted) {
        setState(() {
          _isSyncing = false;
        });
      }
    }
  }

  Future<void> _performSync() async {
    // å®ç°å…·ä½“çš„åŒæ­¥é€»è¾‘
    await Future.delayed(Duration(seconds: 2));
  }

  @override
  Widget build(BuildContext context) {
    if (!widget.config.enableOfflineMode) {
      return widget.onlineBuilder(context);
    }

    if (_isOnline) {
      return Stack(
        children: [
          widget.onlineBuilder(context),
          if (_isSyncing && widget.syncIndicator != null)
            Positioned(
              top: 16,
              right: 16,
              child: widget.syncIndicator!,
            ),
        ],
      );
    } else {
      return widget.offlineBuilder(context);
    }
  }

  @override
  void dispose() {
    _connectivitySubscription.cancel();
    super.dispose();
  }
}
```

### 4. é”™è¯¯æ¢å¤ç³»ç»Ÿ (Error Recovery System)

#### 4.1 æ¶æ„è®¾è®¡

```dart
// å¹³å°çº§é”™è¯¯æ¢å¤ç³»ç»Ÿ
class PlatformErrorRecovery {
  /// é”™è¯¯æ¢å¤é…ç½®
  static const ErrorRecoveryConfig defaultConfig = ErrorRecoveryConfig(
    maxRetries: 3,
    retryDelay: Duration(seconds: 2),
    exponentialBackoff: true,
    enableAutoRecovery: true,
    recoveryTimeout: Duration(seconds: 30),
  );

  /// åˆ›å»ºé”™è¯¯æ¢å¤ç»„ä»¶
  static Widget create({
    required ErrorRecoveryType type,
    ErrorRecoveryConfig? config,
    required Widget Function(BuildContext) contentBuilder,
    required Future<void> Function() recoveryFunction,
    Widget? errorWidget,
    Widget? recoveryWidget,
  }) {
    return ErrorRecoveryWidget(
      type: type,
      config: config ?? defaultConfig,
      contentBuilder: contentBuilder,
      recoveryFunction: recoveryFunction,
      errorWidget: errorWidget,
      recoveryWidget: recoveryWidget,
    );
  }
}

/// é”™è¯¯æ¢å¤ç±»å‹
enum ErrorRecoveryType {
  automatic,   // è‡ªåŠ¨æ¢å¤
  manual,      // æ‰‹åŠ¨æ¢å¤
  hybrid,      // æ··åˆæ¢å¤
  intelligent, // æ™ºèƒ½æ¢å¤
}

/// é”™è¯¯æ¢å¤é…ç½®
class ErrorRecoveryConfig {
  final int maxRetries;
  final Duration retryDelay;
  final bool exponentialBackoff;
  final bool enableAutoRecovery;
  final Duration recoveryTimeout;
  
  const ErrorRecoveryConfig({
    required this.maxRetries,
    required this.retryDelay,
    required this.exponentialBackoff,
    required this.enableAutoRecovery,
    required this.recoveryTimeout,
  });
}
```

#### 4.2 å®ç°ç¤ºä¾‹

```dart
// é”™è¯¯æ¢å¤ç»„ä»¶
class ErrorRecoveryWidget extends StatefulWidget {
  final ErrorRecoveryType type;
  final ErrorRecoveryConfig config;
  final Widget Function(BuildContext) contentBuilder;
  final Future<void> Function() recoveryFunction;
  final Widget? errorWidget;
  final Widget? recoveryWidget;

  const ErrorRecoveryWidget({
    Key? key,
    required this.type,
    required this.config,
    required this.contentBuilder,
    required this.recoveryFunction,
    this.errorWidget,
    this.recoveryWidget,
  }) : super(key: key);

  @override
  State<ErrorRecoveryWidget> createState() => _ErrorRecoveryWidgetState();
}

class _ErrorRecoveryWidgetState extends State<ErrorRecoveryWidget> {
  ErrorState _errorState = ErrorState.normal;
  int _retryCount = 0;
  String? _errorMessage;
  Timer? _recoveryTimer;

  @override
  void initState() {
    super.initState();
    if (widget.config.enableAutoRecovery) {
      _startAutoRecovery();
    }
  }

  void _startAutoRecovery() {
    _recoveryTimer = Timer.periodic(widget.config.recoveryTimeout, (timer) {
      if (_errorState == ErrorState.error && _retryCount < widget.config.maxRetries) {
        _attemptRecovery();
      } else {
        timer.cancel();
      }
    });
  }

  Future<void> _attemptRecovery() async {
    if (_errorState == ErrorState.recovering) return;
    
    setState(() {
      _errorState = ErrorState.recovering;
    });

    try {
      await widget.recoveryFunction();
      
      setState(() {
        _errorState = ErrorState.normal;
        _errorMessage = null;
        _retryCount = 0;
      });
    } catch (e) {
      _handleRecoveryError(e);
    }
  }

  void _handleRecoveryError(dynamic error) {
    _retryCount++;
    
    if (_retryCount >= widget.config.maxRetries) {
      setState(() {
        _errorState = ErrorState.error;
        _errorMessage = error.toString();
      });
    } else {
      final delay = widget.config.exponentialBackoff
          ? widget.config.retryDelay * pow(2, _retryCount - 1)
          : widget.config.retryDelay;
      
      Future.delayed(delay, _attemptRecovery);
    }
  }

  @override
  Widget build(BuildContext context) {
    switch (_errorState) {
      case ErrorState.normal:
        return widget.contentBuilder(context);
      
      case ErrorState.recovering:
        return widget.recoveryWidget ?? 
               _buildRecoveryWidget();
      
      case ErrorState.error:
        return widget.errorWidget ?? 
               _buildErrorWidget();
    }
  }

  Widget _buildRecoveryWidget() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          CircularProgressIndicator(),
          SizedBox(height: 16),
          Text('æ­£åœ¨æ¢å¤...', style: TextStyle(fontSize: 16)),
        ],
      ),
    );
  }

  Widget _buildErrorWidget() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(Icons.error_outline, size: 48, color: Colors.red),
          SizedBox(height: 16),
          Text('å‘ç”Ÿé”™è¯¯', style: TextStyle(fontSize: 16)),
          SizedBox(height: 8),
          Text(_errorMessage ?? 'æœªçŸ¥é”™è¯¯', style: TextStyle(fontSize: 14)),
          SizedBox(height: 16),
          ElevatedButton(
            onPressed: () {
              _retryCount = 0;
              _attemptRecovery();
            },
            child: Text('é‡è¯•'),
          ),
        ],
      ),
    );
  }

  @override
  void dispose() {
    _recoveryTimer?.cancel();
    super.dispose();
  }
}
```

---

## ğŸ”„ é›†æˆå’Œä½¿ç”¨

### 1. å¹³å°æ ¸å¿ƒé›†æˆ

```dart
// å¹³å°æ ¸å¿ƒç±»
class PlatformCore {
  static final PlatformCore _instance = PlatformCore._internal();
  factory PlatformCore() => _instance;
  PlatformCore._internal();

  /// åˆå§‹åŒ–å¹³å°ç»„ä»¶
  Future<void> initialize({
    SkeletonConfig? skeletonConfig,
    ProgressiveConfig? progressiveConfig,
    OfflineConfig? offlineConfig,
    ErrorRecoveryConfig? errorRecoveryConfig,
  }) async {
    // åˆå§‹åŒ–å„ä¸ªç³»ç»Ÿç»„ä»¶
    await _initializeSkeletonSystem(skeletonConfig);
    await _initializeProgressiveLoading(progressiveConfig);
    await _initializeOfflineSupport(offlineConfig);
    await _initializeErrorRecovery(errorRecoveryConfig);
  }

  /// è·å–éª¨æ¶å±ç³»ç»Ÿ
  PlatformSkeleton get skeleton => PlatformSkeleton();
  
  /// è·å–æ¸è¿›å¼åŠ è½½ç³»ç»Ÿ
  PlatformProgressiveLoading get progressiveLoading => PlatformProgressiveLoading();
  
  /// è·å–ç¦»çº¿æ”¯æŒç³»ç»Ÿ
  PlatformOfflineSupport get offlineSupport => PlatformOfflineSupport();
  
  /// è·å–é”™è¯¯æ¢å¤ç³»ç»Ÿ
  PlatformErrorRecovery get errorRecovery => PlatformErrorRecovery();
}
```

### 2. ä¸šåŠ¡æ¨¡å—ä½¿ç”¨ç¤ºä¾‹

```dart
// æœåŠ¡è¯¦æƒ…é¡µé¢ä½¿ç”¨ç¤ºä¾‹
class ServiceDetailPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('æœåŠ¡è¯¦æƒ…')),
      body: PlatformCore().progressiveLoading.create(
        type: ProgressiveType.sequential,
        loadFunction: () async {
          // åŠ è½½æœåŠ¡è¯¦æƒ…æ•°æ®
          await _loadServiceDetail();
        },
        contentBuilder: (context) => _buildContent(context),
        loadingWidget: PlatformCore().skeleton.create(
          type: SkeletonType.detail,
        ),
        errorWidget: PlatformCore().errorRecovery.create(
          type: ErrorRecoveryType.automatic,
          contentBuilder: (context) => _buildContent(context),
          recoveryFunction: () async {
            // é”™è¯¯æ¢å¤é€»è¾‘
            await _recoverServiceDetail();
          },
        ),
      ),
    );
  }

  Widget _buildContent(BuildContext context) {
    return PlatformCore().offlineSupport.create(
      type: OfflineType.hybrid,
      onlineBuilder: (context) => _buildOnlineContent(context),
      offlineBuilder: (context) => _buildOfflineContent(context),
    );
  }
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†

```dart
// å†…å­˜ç®¡ç†ç­–ç•¥
class MemoryManager {
  static final Map<String, dynamic> _cache = {};
  static const int _maxCacheSize = 100;
  
  /// æ·»åŠ ç¼“å­˜é¡¹
  static void addCache(String key, dynamic value) {
    if (_cache.length >= _maxCacheSize) {
      _removeOldestCache();
    }
    _cache[key] = value;
  }
  
  /// è·å–ç¼“å­˜é¡¹
  static T? getCache<T>(String key) {
    return _cache[key] as T?;
  }
  
  /// æ¸…ç†ç¼“å­˜
  static void clearCache() {
    _cache.clear();
  }
  
  /// ç§»é™¤æœ€æ—§çš„ç¼“å­˜
  static void _removeOldestCache() {
    if (_cache.isNotEmpty) {
      final oldestKey = _cache.keys.first;
      _cache.remove(oldestKey);
    }
  }
}
```

### 2. æ€§èƒ½ç›‘æ§

```dart
// æ€§èƒ½ç›‘æ§
class PerformanceMonitor {
  static final Map<String, Stopwatch> _timers = {};
  
  /// å¼€å§‹è®¡æ—¶
  static void startTimer(String name) {
    _timers[name] = Stopwatch()..start();
  }
  
  /// ç»“æŸè®¡æ—¶
  static Duration endTimer(String name) {
    final timer = _timers[name];
    if (timer != null) {
      timer.stop();
      _timers.remove(name);
      return timer.elapsed;
    }
    return Duration.zero;
  }
  
  /// è®°å½•æ€§èƒ½æŒ‡æ ‡
  static void recordMetric(String name, dynamic value) {
    // è®°å½•æ€§èƒ½æŒ‡æ ‡åˆ°ç›‘æ§ç³»ç»Ÿ
    print('Performance Metric: $name = $value');
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```dart
// éª¨æ¶å±ç³»ç»Ÿæµ‹è¯•
void main() {
  group('PlatformSkeleton Tests', () {
    test('should create list skeleton', () {
      final skeleton = PlatformSkeleton.create(type: SkeletonType.list);
      expect(skeleton, isA<Widget>());
    });
    
    test('should create custom skeleton with config', () {
      final config = SkeletonConfig(
        animationDuration: Duration(seconds: 1),
        shimmerColor: Colors.blue,
        baseColor: Colors.grey,
        borderRadius: 4.0,
      );
      
      final skeleton = PlatformSkeleton.create(
        type: SkeletonType.custom,
        config: config,
        customData: {'items': 5},
      );
      
      expect(skeleton, isA<Widget>());
    });
  });
}
```

### 2. é›†æˆæµ‹è¯•

```dart
// é›†æˆæµ‹è¯•
void main() {
  group('Platform Components Integration Tests', () {
    testWidgets('should handle progressive loading with skeleton', (tester) async {
      await tester.pumpWidget(
        MaterialApp(
          home: PlatformCore().progressiveLoading.create(
            type: ProgressiveType.sequential,
            loadFunction: () async {
              await Future.delayed(Duration(milliseconds: 500));
            },
            contentBuilder: (context) => Text('Content Loaded'),
            loadingWidget: PlatformCore().skeleton.create(type: SkeletonType.list),
          ),
        ),
      );
      
      // éªŒè¯éª¨æ¶å±æ˜¾ç¤º
      expect(find.byType(SkeletonListWidget), findsOneWidget);
      
      // ç­‰å¾…åŠ è½½å®Œæˆ
      await tester.pumpAndSettle();
      
      // éªŒè¯å†…å®¹æ˜¾ç¤º
      expect(find.text('Content Loaded'), findsOneWidget);
    });
  });
}
```

---

## ğŸ“ˆ ç›‘æ§å’ŒæŒ‡æ ‡

### 1. å…³é”®æŒ‡æ ‡

```dart
// å…³é”®æŒ‡æ ‡å®šä¹‰
class PlatformMetrics {
  /// éª¨æ¶å±æ˜¾ç¤ºæ—¶é—´
  static const String skeletonDisplayTime = 'skeleton_display_time';
  
  /// æ¸è¿›å¼åŠ è½½å®Œæˆæ—¶é—´
  static const String progressiveLoadingTime = 'progressive_loading_time';
  
  /// ç¦»çº¿æ¨¡å¼ä½¿ç”¨ç‡
  static const String offlineModeUsage = 'offline_mode_usage';
  
  /// é”™è¯¯æ¢å¤æˆåŠŸç‡
  static const String errorRecoverySuccessRate = 'error_recovery_success_rate';
  
  /// ç»„ä»¶ä½¿ç”¨é¢‘ç‡
  static const String componentUsageFrequency = 'component_usage_frequency';
}
```

### 2. ç›‘æ§å®ç°

```dart
// ç›‘æ§å®ç°
class MetricsCollector {
  static final Map<String, List<dynamic>> _metrics = {};
  
  /// è®°å½•æŒ‡æ ‡
  static void recordMetric(String name, dynamic value) {
    if (!_metrics.containsKey(name)) {
      _metrics[name] = [];
    }
    _metrics[name]!.add(value);
  }
  
  /// è·å–æŒ‡æ ‡ç»Ÿè®¡
  static Map<String, dynamic> getMetrics() {
    final result = <String, dynamic>{};
    
    _metrics.forEach((key, values) {
      if (values.isNotEmpty) {
        if (values.first is num) {
          final numbers = values.cast<num>();
          result[key] = {
            'count': numbers.length,
            'average': numbers.reduce((a, b) => a + b) / numbers.length,
            'min': numbers.reduce((a, b) => a < b ? a : b),
            'max': numbers.reduce((a, b) => a > b ? a : b),
          };
        } else {
          result[key] = {
            'count': values.length,
            'values': values,
          };
        }
      }
    });
    
    return result;
  }
}
```

---

## ğŸ”„ æŒç»­æ”¹è¿›

### 1. ç‰ˆæœ¬ç®¡ç†

```dart
// ç‰ˆæœ¬ç®¡ç†
class PlatformVersion {
  static const String currentVersion = '1.0.0';
  static const Map<String, String> componentVersions = {
    'skeleton': '1.0.0',
    'progressive_loading': '1.0.0',
    'offline_support': '1.0.0',
    'error_recovery': '1.0.0',
  };
  
  /// æ£€æŸ¥ç»„ä»¶ç‰ˆæœ¬å…¼å®¹æ€§
  static bool isCompatible(String component, String version) {
    final requiredVersion = componentVersions[component];
    return requiredVersion == version;
  }
}
```

### 2. å‡çº§ç­–ç•¥

```dart
// å‡çº§ç­–ç•¥
class PlatformUpgrade {
  /// æ£€æŸ¥å‡çº§
  static Future<bool> checkForUpgrade() async {
    // æ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬
    return false;
  }
  
  /// æ‰§è¡Œå‡çº§
  static Future<void> performUpgrade() async {
    // æ‰§è¡Œå‡çº§é€»è¾‘
  }
  
  /// å›æ»šå‡çº§
  static Future<void> rollbackUpgrade() async {
    // å›æ»šå‡çº§é€»è¾‘
  }
}
```

---

## ğŸ“ æ”¯æŒå’Œç»´æŠ¤

### 1. æ–‡æ¡£å’ŒåŸ¹è®­

- **å¼€å‘æ–‡æ¡£**ï¼šè¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- **æœ€ä½³å®è·µ**ï¼šæ¨èçš„ä½¿ç”¨æ¨¡å¼å’Œæ³¨æ„äº‹é¡¹
- **åŸ¹è®­ææ–™**ï¼šå›¢é˜ŸåŸ¹è®­å’ŒçŸ¥è¯†åˆ†äº«

### 2. æŠ€æœ¯æ”¯æŒ

- **é—®é¢˜åé¦ˆ**ï¼šå»ºç«‹é—®é¢˜åé¦ˆæ¸ é“
- **æŠ€æœ¯æ”¯æŒ**ï¼šæä¾›æŠ€æœ¯æ”¯æŒå’Œè§£å†³æ–¹æ¡ˆ
- **ç¤¾åŒºæ”¯æŒ**ï¼šå»ºç«‹å¼€å‘è€…ç¤¾åŒº

### 3. ç»´æŠ¤è®¡åˆ’

- **å®šæœŸç»´æŠ¤**ï¼šå®šæœŸæ£€æŸ¥å’Œæ›´æ–°ç»„ä»¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒç»­çš„æ€§èƒ½ä¼˜åŒ–å’Œæ”¹è¿›
- **å®‰å…¨æ›´æ–°**ï¼šåŠæ—¶çš„å®‰å…¨æ›´æ–°å’Œä¿®å¤

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€ç»„ä»¶å¼€å‘ï¼ˆ2-3å‘¨ï¼‰
- [ ] éª¨æ¶å±ç³»ç»Ÿå¼€å‘
- [ ] æ¸è¿›å¼åŠ è½½ç³»ç»Ÿå¼€å‘
- [ ] åŸºç¡€æµ‹è¯•å’Œæ–‡æ¡£

### é˜¶æ®µ2ï¼šé«˜çº§åŠŸèƒ½å¼€å‘ï¼ˆ2-3å‘¨ï¼‰
- [ ] ç¦»çº¿æ”¯æŒç³»ç»Ÿå¼€å‘
- [ ] é”™è¯¯æ¢å¤ç³»ç»Ÿå¼€å‘
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•

### é˜¶æ®µ3ï¼šé›†æˆå’Œæµ‹è¯•ï¼ˆ1-2å‘¨ï¼‰
- [ ] å¹³å°æ ¸å¿ƒé›†æˆ
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

### é˜¶æ®µ4ï¼šéƒ¨ç½²å’Œç›‘æ§ï¼ˆ1å‘¨ï¼‰
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [ ] ç›‘æ§ç³»ç»Ÿé…ç½®
- [ ] æ–‡æ¡£å®Œå–„

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2024å¹´12æœˆ  
**ä¸‹æ¬¡è¯„å®¡ï¼š** 2025å¹´1æœˆ 
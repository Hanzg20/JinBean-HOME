# GoldSky MessageCore Azureè¿ç§»ç­–ç•¥

## ðŸ“‹ ç›®å½•
1. [è¿ç§»èƒŒæ™¯](#1-è¿ç§»èƒŒæ™¯)
2. [Microsoft Startupé¡¹ç›®ç”³è¯·](#2-microsoft-startupé¡¹ç›®ç”³è¯·)
3. [Azureæž¶æž„è®¾è®¡](#3-azureæž¶æž„è®¾è®¡)
4. [è¿ç§»å®žæ–½è®¡åˆ’](#4-è¿ç§»å®žæ–½è®¡åˆ’)
5. [æŠ€æœ¯è¿ç§»æ–¹æ¡ˆ](#5-æŠ€æœ¯è¿ç§»æ–¹æ¡ˆ)
6. [æˆæœ¬å¯¹æ¯”åˆ†æž](#6-æˆæœ¬å¯¹æ¯”åˆ†æž)
7. [é£Žé™©æŽ§åˆ¶](#7-é£Žé™©æŽ§åˆ¶)

## 1. è¿ç§»èƒŒæ™¯

### 1.1 è¿è¡ŒåŠ¨å› 

```yaml
ä¸šåŠ¡é©±åŠ¨:
  - ç”³è¯·Microsoft Startupé¡¹ç›®
  - èŽ·å¾—$150,000 Azureå…è´¹é¢åº¦
  - ä¼ä¸šçº§æœåŠ¡æ”¯æŒ
  - å…¨çƒåŒ–éƒ¨ç½²èƒ½åŠ›

æŠ€æœ¯é©±åŠ¨:
  - æ›´å¼ºå¤§çš„ä¼ä¸šçº§æœåŠ¡
  - æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§
  - æ›´å®Œå–„çš„ç›‘æŽ§å’Œè¿ç»´
  - æ›´ä¸°å¯Œçš„AI/MLé›†æˆ
```

### 1.2 è¿ç§»æ—¶æœº

```mermaid
gantt
    title GoldSky MessageCore è¿ç§»æ—¶é—´çº¿
    dateFormat  YYYY-MM-DD
    section åˆæœŸé˜¶æ®µ
    Supabaseå¼€å‘     :done, dev, 2024-01-01, 2024-06-30
    section è¿ç§»å‡†å¤‡
    Microsoftç”³è¯·    :active, ms, 2024-05-01, 2024-06-30
    Azureæž¶æž„è®¾è®¡    :active, arch, 2024-06-01, 2024-07-31
    section è¿ç§»å®žæ–½
    æ•°æ®è¿ç§»         :migration, 2024-07-01, 2024-07-15
    æœåŠ¡è¿ç§»         :service, 2024-07-15, 2024-07-31
    åˆ‡æ¢ä¸Šçº¿         :switch, 2024-08-01, 2024-08-07
```

## 2. Microsoft Startupé¡¹ç›®ç”³è¯·

### 2.1 ç”³è¯·æ¡ä»¶

```yaml
åŸºæœ¬è¦æ±‚:
  - æˆç«‹æ—¶é—´: ä¸è¶…è¿‡5å¹´
  - èžèµ„é˜¶æ®µ: ç§å­è½®åˆ°Bè½®
  - æŠ€æœ¯äº§å“: åŸºäºŽäº‘æœåŠ¡
  - å›¢é˜Ÿè§„æ¨¡: 2-50äºº

ç”³è¯·ææ–™:
  - å…¬å¸æ³¨å†Œä¿¡æ¯
  - äº§å“ä»‹ç»å’Œæ¼”ç¤º
  - æŠ€æœ¯æž¶æž„è¯´æ˜Ž
  - å•†ä¸šè®¡åˆ’ä¹¦
  - å›¢é˜Ÿä»‹ç»
```

### 2.2 ç”³è¯·æµç¨‹

```bash
# 1. æ³¨å†ŒMicrosoft for Startups
è®¿é—®: https://startups.microsoft.com/
æ³¨å†Œ: åˆ›å»ºè´¦æˆ·å¹¶å¡«å†™åŸºæœ¬ä¿¡æ¯

# 2. æäº¤ç”³è¯·
- ä¸Šä¼ å…¬å¸èµ„æ–™
- å¡«å†™äº§å“ä¿¡æ¯
- è¯´æ˜ŽæŠ€æœ¯æž¶æž„
- æè¿°Azureä½¿ç”¨è®¡åˆ’

# 3. å®¡æ ¸æµç¨‹
- åˆæ­¥å®¡æ ¸ (1-2å‘¨)
- æŠ€æœ¯è¯„å®¡ (2-3å‘¨)
- æœ€ç»ˆæ‰¹å‡† (1å‘¨)

# 4. èŽ·å¾—ç¦åˆ©
- $150,000 Azureå…è´¹é¢åº¦
- æŠ€æœ¯ä¸“å®¶æ”¯æŒ
- ä¼ä¸šçº§æœåŠ¡
- å¸‚åœºæŽ¨å¹¿æ”¯æŒ
```

### 2.3 ç”³è¯·ç­–ç•¥

```yaml
ç”³è¯·é‡ç‚¹:
  - å¼ºè°ƒGoldSky MessageCoreçš„åˆ›æ–°æ€§
  - å±•ç¤ºå¤šç§Ÿæˆ·SaaSæž¶æž„
  - è¯´æ˜ŽAzureæœåŠ¡çš„ä½¿ç”¨è®¡åˆ’
  - çªå‡ºä¼ä¸šçº§åº”ç”¨åœºæ™¯

æŠ€æœ¯äº®ç‚¹:
  - å®žæ—¶é€šä¿¡æŠ€æœ¯
  - å¤šç§Ÿæˆ·éš”ç¦»
  - ä¼ä¸šçº§å®‰å…¨
  - å…¨çƒåŒ–éƒ¨ç½²
```

## 3. Azureæž¶æž„è®¾è®¡

### 3.1 æœåŠ¡æ˜ å°„

```mermaid
graph TB
    subgraph "SupabaseæœåŠ¡"
        A1[Supabase PostgreSQL]
        A2[Supabase Storage]
        A3[Supabase Auth]
        A4[Supabase Realtime]
        A5[Supabase Edge Functions]
    end
    
    subgraph "AzureæœåŠ¡"
        B1[Azure Database for PostgreSQL]
        B2[Azure Blob Storage]
        B3[Azure Active Directory B2C]
        B4[Azure SignalR Service]
        B5[Azure Functions]
    end
    
    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4
    A5 --> B5
```

### 3.2 Azureæž¶æž„å›¾

```yaml
å‰ç«¯å±‚:
  - Azure CDN: é™æ€èµ„æºåˆ†å‘
  - Azure Front Door: å…¨çƒè´Ÿè½½å‡è¡¡
  - Azure Application Gateway: APIç½‘å…³

åº”ç”¨å±‚:
  - Azure Container Instances: å¾®æœåŠ¡å®¹å™¨
  - Azure Functions: æ— æœåŠ¡å™¨å‡½æ•°
  - Azure SignalR Service: å®žæ—¶é€šä¿¡

æ•°æ®å±‚:
  - Azure Database for PostgreSQL: ä¸»æ•°æ®åº“
  - Azure Cache for Redis: ç¼“å­˜æœåŠ¡
  - Azure Blob Storage: æ–‡ä»¶å­˜å‚¨
  - Azure Cosmos DB: ä¼šè¯æ•°æ®

å®‰å…¨å±‚:
  - Azure Active Directory B2C: ç”¨æˆ·è®¤è¯
  - Azure Key Vault: å¯†é’¥ç®¡ç†
  - Azure Security Center: å®‰å…¨ç›‘æŽ§

ç›‘æŽ§å±‚:
  - Azure Application Insights: åº”ç”¨ç›‘æŽ§
  - Azure Monitor: åŸºç¡€è®¾æ–½ç›‘æŽ§
  - Azure Log Analytics: æ—¥å¿—åˆ†æž
```

### 3.3 æˆæœ¬ä¼˜åŒ–ç­–ç•¥

```yaml
å…è´¹é¢åº¦ä½¿ç”¨:
  - Azure Database for PostgreSQL: 750å°æ—¶/æœˆ
  - Azure Blob Storage: 5GB/æœˆ
  - Azure Functions: 1Mæ¬¡æ‰§è¡Œ/æœˆ
  - Azure SignalR Service: 20Kè¿žæŽ¥/æœˆ

æˆæœ¬æŽ§åˆ¶:
  - ä½¿ç”¨é¢„ç•™å®žä¾‹
  - è‡ªåŠ¨æ‰©ç¼©å®¹
  - æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - å¤šåŒºåŸŸéƒ¨ç½²ä¼˜åŒ–
```

## 4. è¿ç§»å®žæ–½è®¡åˆ’

### 4.1 è¿ç§»é˜¶æ®µ

```yaml
Phase 1: å‡†å¤‡é˜¶æ®µ (1ä¸ªæœˆ)
  ä»»åŠ¡:
    - ç”³è¯·Microsoft Startupé¡¹ç›®
    - è®¾è®¡Azureæž¶æž„
    - å‡†å¤‡è¿ç§»è„šæœ¬
    - æ­å»ºæµ‹è¯•çŽ¯å¢ƒ
    - åˆ¶å®šå›žæ»šè®¡åˆ’

  äº¤ä»˜ç‰©:
    - Azureæž¶æž„è®¾è®¡æ–‡æ¡£
    - è¿ç§»è„šæœ¬å’Œå·¥å…·
    - æµ‹è¯•çŽ¯å¢ƒé…ç½®
    - é£Žé™©è¯„ä¼°æŠ¥å‘Š

Phase 2: æ•°æ®è¿ç§» (2å‘¨)
  ä»»åŠ¡:
    - æ•°æ®åº“è¿ç§» (PostgreSQL)
    - æ–‡ä»¶å­˜å‚¨è¿ç§» (Blob Storage)
    - ç”¨æˆ·æ•°æ®è¿ç§» (AAD B2C)
    - æ•°æ®éªŒè¯å’Œæµ‹è¯•

  äº¤ä»˜ç‰©:
    - æ•°æ®è¿ç§»æŠ¥å‘Š
    - æ•°æ®å®Œæ•´æ€§éªŒè¯
    - æ€§èƒ½åŸºå‡†æµ‹è¯•

Phase 3: æœåŠ¡è¿ç§» (2å‘¨)
  ä»»åŠ¡:
    - APIæœåŠ¡è¿ç§»åˆ°Azure
    - å®žæ—¶é€šä¿¡è¿ç§» (SignalR)
    - è®¤è¯ç³»ç»Ÿè¿ç§» (AAD B2C)
    - é›†æˆæµ‹è¯•

  äº¤ä»˜ç‰©:
    - æœåŠ¡è¿ç§»æŠ¥å‘Š
    - APIæ€§èƒ½æµ‹è¯•
    - åŠŸèƒ½éªŒè¯æŠ¥å‘Š

Phase 4: åˆ‡æ¢ä¸Šçº¿ (1å‘¨)
  ä»»åŠ¡:
    - ç°åº¦å‘å¸ƒ
    - ç›‘æŽ§éªŒè¯
    - å…¨é‡åˆ‡æ¢
    - æ—§æœåŠ¡æ¸…ç†

  äº¤ä»˜ç‰©:
    - ä¸Šçº¿æˆåŠŸæŠ¥å‘Š
    - æ€§èƒ½ç›‘æŽ§æŠ¥å‘Š
    - ç”¨æˆ·åé¦ˆæ”¶é›†
```

### 4.2 è¿ç§»å·¥å…·

```bash
# æ•°æ®åº“è¿ç§»å·¥å…·
pg_dump -h supabase-host -U postgres -d messagecore > backup.sql
psql -h azure-host -U postgres -d messagecore < backup.sql

# æ–‡ä»¶å­˜å‚¨è¿ç§»å·¥å…·
az storage blob copy start-batch \
  --source-container supabase-storage \
  --destination-container azure-storage \
  --source-account-name supabase \
  --destination-account-name azure

# ç”¨æˆ·æ•°æ®è¿ç§»å·¥å…·
# ä½¿ç”¨Azure AD Graph APIè¿ç§»ç”¨æˆ·æ•°æ®
```

## 5. æŠ€æœ¯è¿ç§»æ–¹æ¡ˆ

### 5.1 æ•°æ®åº“è¿ç§»

```sql
-- 1. åˆ›å»ºAzure PostgreSQLæ•°æ®åº“
CREATE DATABASE messagecore;

-- 2. è¿ç§»è¡¨ç»“æž„
-- ä½¿ç”¨Prismaè¿ç§»å·¥å…·
npx prisma migrate deploy

-- 3. æ•°æ®è¿ç§»è„šæœ¬
-- ä½¿ç”¨pg_dumpå’Œpsqlè¿›è¡Œæ•°æ®è¿ç§»
pg_dump -h supabase-host -U postgres -d messagecore \
  --data-only --disable-triggers > data.sql

psql -h azure-host -U postgres -d messagecore < data.sql

-- 4. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT COUNT(*) FROM tenants;
SELECT COUNT(*) FROM messages;
SELECT COUNT(*) FROM conversations;
```

### 5.2 æ–‡ä»¶å­˜å‚¨è¿ç§»

```javascript
// Azure Blob Storageè¿ç§»è„šæœ¬
const { BlobServiceClient } = require('@azure/storage-blob');

async function migrateFiles() {
  // ä»ŽSupabaseä¸‹è½½æ–‡ä»¶
  const supabaseFiles = await supabase.storage
    .from('messagecore')
    .list();

  // ä¸Šä¼ åˆ°Azure Blob Storage
  const blobServiceClient = BlobServiceClient.fromConnectionString(
    process.env.AZURE_STORAGE_CONNECTION_STRING
  );

  for (const file of supabaseFiles) {
    const blobClient = blobServiceClient
      .getContainerClient('messagecore')
      .getBlobClient(file.name);

    await blobClient.upload(file.data, file.data.length);
  }
}
```

### 5.3 è®¤è¯ç³»ç»Ÿè¿ç§»

```javascript
// Azure AD B2Cè¿ç§»é…ç½®
const msalConfig = {
  auth: {
    clientId: process.env.AZURE_CLIENT_ID,
    authority: `https://${process.env.AZURE_TENANT}.b2clogin.com/${process.env.AZURE_TENANT}.onmicrosoft.com/${process.env.AZURE_POLICY}`,
    knownAuthorities: [`${process.env.AZURE_TENANT}.b2clogin.com`]
  },
  cache: {
    cacheLocation: 'localStorage',
    storeAuthStateInCookie: false
  }
};

// ç”¨æˆ·æ•°æ®è¿ç§»
async function migrateUsers() {
  const users = await supabase.auth.admin.listUsers();
  
  for (const user of users.data) {
    await createAzureADUser({
      displayName: user.user_metadata.full_name,
      email: user.email,
      password: generateTemporaryPassword()
    });
  }
}
```

### 5.4 å®žæ—¶é€šä¿¡è¿ç§»

```javascript
// Azure SignalR Serviceé…ç½®
const { HubConnectionBuilder } = require('@microsoft/signalr');

const connection = new HubConnectionBuilder()
  .withUrl(process.env.AZURE_SIGNALR_URL)
  .withAutomaticReconnect()
  .build();

// è¿ç§»WebSocketè¿žæŽ¥
async function migrateRealtimeConnections() {
  // é€šçŸ¥å®¢æˆ·ç«¯é‡æ–°è¿žæŽ¥åˆ°Azure SignalR
  await supabase.channel('migration')
    .send({
      type: 'broadcast',
      event: 'migrate_to_azure',
      payload: {
        newUrl: process.env.AZURE_SIGNALR_URL,
        migrationTime: new Date().toISOString()
      }
    });
}
```

## 6. æˆæœ¬å¯¹æ¯”åˆ†æž

### 6.1 åˆæœŸæˆæœ¬å¯¹æ¯” (1ä¸‡ç”¨æˆ·)

```yaml
Supabaseæˆæœ¬:
  æ•°æ®åº“: $25/æœˆ (åŸºç¡€è®¡åˆ’)
  å­˜å‚¨: $5/æœˆ (1GB)
  å¸¦å®½: $10/æœˆ
  æ€»è®¡: $40/æœˆ

Azureæˆæœ¬ (ä½¿ç”¨å…è´¹é¢åº¦):
  æ•°æ®åº“: $0/æœˆ (å…è´¹é¢åº¦å†…)
  å­˜å‚¨: $0/æœˆ (5GBå…è´¹)
  å¸¦å®½: $0/æœˆ (å…è´¹é¢åº¦å†…)
  æ€»è®¡: $0/æœˆ

èŠ‚çœæˆæœ¬: $40/æœˆ (100%èŠ‚çœ)
```

### 6.2 æˆé•¿æœŸæˆæœ¬å¯¹æ¯” (10ä¸‡ç”¨æˆ·)

```yaml
Supabaseæˆæœ¬:
  æ•°æ®åº“: $100/æœˆ (ä¸“ä¸šè®¡åˆ’)
  å­˜å‚¨: $50/æœˆ (10GB)
  å¸¦å®½: $100/æœˆ
  æ€»è®¡: $250/æœˆ

Azureæˆæœ¬ (ä½¿ç”¨Startupé¢åº¦):
  æ•°æ®åº“: $0/æœˆ (å…è´¹é¢åº¦å†…)
  å­˜å‚¨: $0/æœˆ (å…è´¹é¢åº¦å†…)
  å¸¦å®½: $0/æœˆ (å…è´¹é¢åº¦å†…)
  æ€»è®¡: $0/æœˆ

èŠ‚çœæˆæœ¬: $250/æœˆ (100%èŠ‚çœ)
```

### 6.3 é•¿æœŸæˆæœ¬ä¼˜åŠ¿

```yaml
Microsoft Startupç¦åˆ©:
  - $150,000å…è´¹é¢åº¦ (çº¦2å¹´å…è´¹ä½¿ç”¨)
  - æŠ€æœ¯ä¸“å®¶æ”¯æŒ (ä»·å€¼$50,000/å¹´)
  - ä¼ä¸šçº§æœåŠ¡ (ä»·å€¼$100,000/å¹´)
  - å¸‚åœºæŽ¨å¹¿æ”¯æŒ (ä»·å€¼$200,000/å¹´)

æ€»ä»·å€¼: $500,000+ (2å¹´)
```

## 7. é£Žé™©æŽ§åˆ¶

### 7.1 æŠ€æœ¯é£Žé™©

```yaml
æ•°æ®ä¸¢å¤±é£Žé™©:
  ç¼“è§£æŽªæ–½:
    - å¤šé‡å¤‡ä»½ç­–ç•¥
    - æ•°æ®å®Œæ•´æ€§éªŒè¯
    - å›žæ»šè®¡åˆ’å‡†å¤‡
    - åˆ†é˜¶æ®µè¿ç§»

æœåŠ¡ä¸­æ–­é£Žé™©:
  ç¼“è§£æŽªæ–½:
    - ç°åº¦å‘å¸ƒç­–ç•¥
    - åŒæ´»éƒ¨ç½²
    - ç›‘æŽ§å‘Šè­¦
    - å¿«é€Ÿå›žæ»šæœºåˆ¶

æ€§èƒ½ä¸‹é™é£Žé™©:
  ç¼“è§£æŽªæ–½:
    - æ€§èƒ½åŸºå‡†æµ‹è¯•
    - è´Ÿè½½æµ‹è¯•
    - æ€§èƒ½ç›‘æŽ§
    - ä¼˜åŒ–è°ƒæ•´
```

### 7.2 ä¸šåŠ¡é£Žé™©

```yaml
ç”¨æˆ·å½±å“é£Žé™©:
  ç¼“è§£æŽªæ–½:
    - ç”¨æˆ·é€šçŸ¥è®¡åˆ’
    - ç»´æŠ¤çª—å£å®‰æŽ’
    - å®¢æœæ”¯æŒå‡†å¤‡
    - è¡¥å¿æ–¹æ¡ˆ

åˆè§„é£Žé™©:
  ç¼“è§£æŽªæ–½:
    - æ•°æ®ä¿æŠ¤åˆè§„
    - éšç§æ”¿ç­–æ›´æ–°
    - æ³•å¾‹å®¡æŸ¥
    - ç”¨æˆ·åŒæ„èŽ·å–
```

### 7.3 åº”æ€¥é¢„æ¡ˆ

```bash
# å¿«é€Ÿå›žæ»šè„šæœ¬
#!/bin/bash
echo "å¼€å§‹å›žæ»šåˆ°Supabase..."

# 1. åˆ‡æ¢DNS
az network dns record-set a update \
  --resource-group messagecore-rg \
  --zone-name messagecore.com \
  --name api \
  --target-resource supabase-endpoint

# 2. é€šçŸ¥ç”¨æˆ·
curl -X POST https://api.messagecore.com/notifications \
  -H "Content-Type: application/json" \
  -d '{"type": "maintenance", "message": "ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¯·ç¨åŽå†è¯•"}'

# 3. ç›‘æŽ§æœåŠ¡çŠ¶æ€
echo "å›žæ»šå®Œæˆï¼Œç›‘æŽ§æœåŠ¡çŠ¶æ€..."
```

## æ€»ç»“

GoldSky MessageCoreçš„Azureè¿ç§»ç­–ç•¥å°†å¸¦æ¥ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **æˆæœ¬ä¼˜åŠ¿**: èŽ·å¾—$150,000å…è´¹é¢åº¦ï¼Œå¤§å¹…é™ä½Žè¿è¥æˆæœ¬
2. **æŠ€æœ¯ä¼˜åŠ¿**: ä¼ä¸šçº§æœåŠ¡ï¼Œæ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§
3. **å•†ä¸šä¼˜åŠ¿**: Microsoft Startupé¡¹ç›®æ”¯æŒï¼Œå¸‚åœºæŽ¨å¹¿æœºä¼š
4. **æˆ˜ç•¥ä¼˜åŠ¿**: ä¸ºGoldSkyç”Ÿæ€çš„å…¨çƒåŒ–éƒ¨ç½²å¥ å®šåŸºç¡€

é€šè¿‡åˆ†é˜¶æ®µè¿ç§»å’Œé£Žé™©æŽ§åˆ¶æŽªæ–½ï¼Œç¡®ä¿è¿ç§»è¿‡ç¨‹å¹³ç¨³ï¼Œä¸šåŠ¡è¿žç»­æ€§ä¸å—å½±å“ã€‚ 
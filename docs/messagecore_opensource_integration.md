# GoldSky MessageCoreå¼€æºé¡¹ç›®é›†æˆæ”¹é€ æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
1. [å¼€æºé¡¹ç›®è°ƒç ”](#1-å¼€æºé¡¹ç›®è°ƒç ”)
2. [æ¨èæ–¹æ¡ˆ](#2-æ¨èæ–¹æ¡ˆ)
3. [æ”¹é€ è§„åˆ’](#3-æ”¹é€ è§„åˆ’)
4. [é›†æˆæ­¥éª¤](#4-é›†æˆæ­¥éª¤)
5. [å¿«é€Ÿå¯åŠ¨](#5-å¿«é€Ÿå¯åŠ¨)

## 1. å¼€æºé¡¹ç›®è°ƒç ”

### 1.1 åç«¯æ¶ˆæ¯æœåŠ¡æ¨è

#### ğŸ¥‡ **Chatwoot** (Ruby on Rails)
```yaml
é¡¹ç›®åœ°å€: https://github.com/chatwoot/chatwoot
Stars: 20.1k
è¯­è¨€: Ruby on Rails + Vue.js
è®¸å¯è¯: MIT

ä¼˜åŠ¿:
  - å®Œæ•´çš„å®¢æœç³»ç»Ÿ
  - æ”¯æŒå¤šæ¸ é“ (Web, Email, WhatsAppç­‰)
  - è‰¯å¥½çš„APIè®¾è®¡
  - æ´»è·ƒçš„ç¤¾åŒº
  - æ”¯æŒå¤šç§Ÿæˆ·

åŠ£åŠ¿:
  - RubyæŠ€æœ¯æ ˆï¼Œå›¢é˜Ÿéœ€è¦å­¦ä¹ æˆæœ¬
  - åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œéœ€è¦å¤§é‡è£å‰ª
```

#### ğŸ¥ˆ **Rocket.Chat** (Node.js)
```yaml
é¡¹ç›®åœ°å€: https://github.com/RocketChat/Rocket.Chat
Stars: 40k+
è¯­è¨€: Node.js + React
è®¸å¯è¯: MIT

ä¼˜åŠ¿:
  - ä¼ä¸šçº§å³æ—¶é€šè®¯
  - æ”¯æŒå®æ—¶æ¶ˆæ¯
  - å®Œæ•´çš„API
  - æ’ä»¶ç³»ç»Ÿ
  - æ”¯æŒå¤šç§Ÿæˆ·

åŠ£åŠ¿:
  - åŠŸèƒ½åºå¤§ï¼Œéœ€è¦å¤§é‡å®šåˆ¶
  - æ¶æ„å¤æ‚
```

#### ğŸ¥‰ **Matrix Synapse** (Python)
```yaml
é¡¹ç›®åœ°å€: https://github.com/matrix-org/synapse
Stars: 11.7k
è¯­è¨€: Python
è®¸å¯è¯: Apache 2.0

ä¼˜åŠ¿:
  - åˆ†å¸ƒå¼æ¶æ„
  - ç«¯åˆ°ç«¯åŠ å¯†
  - è”é‚¦åè®®
  - å¼ºå¤§çš„æ¶ˆæ¯åŠŸèƒ½

åŠ£åŠ¿:
  - åè®®å¤æ‚
  - å­¦ä¹ æˆæœ¬é«˜
  - è¿‡åº¦è®¾è®¡
```

### 1.2 Node.jsè½»é‡çº§æ–¹æ¡ˆæ¨è

#### ğŸŒŸ **Socket.io Chat Example** + **Nest.js**
```yaml
åŸºç¡€é¡¹ç›®:
  - Socket.ioå®˜æ–¹èŠå¤©ç¤ºä¾‹
  - Nest.js + Socket.ioé›†æˆ
  
ä¼˜åŠ¿:
  - è½»é‡çº§ï¼Œæ˜“äºæ‰©å±•
  - Node.jsæŠ€æœ¯æ ˆç†Ÿæ‚‰
  - å¯æ§æ€§å¼º
  - å¿«é€Ÿå¼€å‘
```

#### ğŸŒŸ **Feathers.js Real-time Chat**
```yaml
é¡¹ç›®åœ°å€: https://github.com/feathersjs/feathers-chat
Stars: 500+
è¯­è¨€: Node.js
è®¸å¯è¯: MIT

ä¼˜åŠ¿:
  - å®æ—¶APIæ¡†æ¶
  - è‡ªåŠ¨ç”ŸæˆRESTful + WebSocket API
  - ç®€æ´çš„æ¶æ„
  - æ˜“äºæ‰©å±•å¤šç§Ÿæˆ·
```

### 1.3 å‰ç«¯SDKæ¨è

#### **Stream Chat SDK**
```yaml
é¡¹ç›®åœ°å€: https://github.com/GetStream/stream-chat-js
è¯­è¨€: TypeScript
è®¸å¯è¯: å•†ä¸šå‹å¥½

ä¼˜åŠ¿:
  - æˆç†Ÿçš„èŠå¤©SDK
  - æ”¯æŒReact/Flutter/JavaScript
  - å®Œæ•´çš„UIç»„ä»¶
  - å¯ä»¥å‚è€ƒAPIè®¾è®¡
```

## 2. æ¨èæ–¹æ¡ˆ

### 2.1 æœ€ä½³æ–¹æ¡ˆï¼šFeathers.js + å®šåˆ¶æ”¹é€ 

```mermaid
graph TB
    subgraph "å¼€æºåŸºç¡€"
        A[Feathers.js Core]
        B[Socket.io Integration]
        C[Authentication]
        D[Database ORM]
    end
    
    subgraph "æˆ‘ä»¬çš„æ”¹é€ "
        E[å¤šç§Ÿæˆ·ç³»ç»Ÿ]
        F[é…é¢ç®¡ç†]
        G[æ¶ˆæ¯è·¯ç”±]
        H[æ–‡ä»¶æœåŠ¡]
        I[ç®¡ç†åå°]
    end
    
    subgraph "SDKå¼€å‘"
        J[JavaScript SDK]
        K[Flutter SDK]
        L[React Components]
    end
    
    A --> E
    B --> G
    C --> E
    D --> F
    
    E --> J
    F --> K
    G --> L
```

### 2.2 æŠ€æœ¯æ¶æ„

```yaml
æ ¸å¿ƒæ¡†æ¶: Feathers.js (Node.js)
æ•°æ®åº“: PostgreSQL + Prisma ORM
å®æ—¶é€šä¿¡: Socket.io
è®¤è¯: JWT + Passport
ç¼“å­˜: Redis
æ–‡ä»¶å­˜å‚¨: AWS S3 / æœ¬åœ°å­˜å‚¨
å‰ç«¯: React + TypeScript
ç§»åŠ¨ç«¯: Flutter SDK
```

### 2.3 å¼€å‘ä¼˜åŠ¿

```yaml
æ—¶é—´èŠ‚çœ:
  - åŸºç¡€å®æ—¶é€šä¿¡: 70%æ—¶é—´èŠ‚çœ
  - è®¤è¯ç³»ç»Ÿ: 60%æ—¶é—´èŠ‚çœ
  - RESTful API: 80%æ—¶é—´èŠ‚çœ
  - WebSocketå¤„ç†: 90%æ—¶é—´èŠ‚çœ

æ€»ä½“å¼€å‘æ—¶é—´:
  - åŸè®¡åˆ’16å‘¨ â†’ ä¼˜åŒ–å8-10å‘¨
  - äººåŠ›æˆæœ¬é™ä½50%
```

## 3. æ”¹é€ è§„åˆ’

### 3.1 Phase 1: åŸºç¡€é¡¹ç›®æ­å»º (1å‘¨)

```bash
# 1. å…‹éš†Feathers.jsèŠå¤©ç¤ºä¾‹
git clone https://github.com/feathersjs/feathers-chat.git messagecore
cd messagecore

# 2. å®‰è£…ä¾èµ–å¹¶å¯åŠ¨
npm install
npm start

# 3. åˆ†æç°æœ‰æ¶æ„
# - æŸ¥çœ‹src/ç›®å½•ç»“æ„
# - ç†è§£services/hooksæœºåˆ¶
# - åˆ†æå®¢æˆ·ç«¯è¿æ¥æ–¹å¼
```

**æ”¹é€ é‡ç‚¹:**
- ç†è§£Feathers.jsæ¶æ„
- åˆ†ææ¶ˆæ¯æµç¨‹
- è§„åˆ’å¤šç§Ÿæˆ·æ”¹é€ æ–¹æ¡ˆ

### 3.2 Phase 2: å¤šç§Ÿæˆ·æ¶æ„æ”¹é€  (2å‘¨)

#### 3.2.1 æ•°æ®åº“Schemaæ”¹é€ 

```sql
-- æ·»åŠ ç§Ÿæˆ·è¡¨
CREATE TABLE tenants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    api_key VARCHAR(255) UNIQUE NOT NULL,
    plan_type VARCHAR(50) DEFAULT 'basic',
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ä¿®æ”¹ç°æœ‰ç”¨æˆ·è¡¨
ALTER TABLE users ADD COLUMN tenant_id UUID REFERENCES tenants(id);
ALTER TABLE users ADD COLUMN external_user_id VARCHAR(255);
ALTER TABLE users ADD UNIQUE(tenant_id, external_user_id);

-- ä¿®æ”¹æ¶ˆæ¯è¡¨
ALTER TABLE messages ADD COLUMN tenant_id UUID REFERENCES tenants(id);

-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_messages_tenant ON messages(tenant_id, created_at DESC);
```

#### 3.2.2 Feathers.js Hookæ”¹é€ 

```javascript
// src/hooks/multi-tenant.js
const multiTenant = () => {
  return async (context) => {
    // API KeyéªŒè¯
    const apiKey = context.params.headers['x-api-key'];
    if (!apiKey) {
      throw new Error('API key required');
    }

    // è·å–ç§Ÿæˆ·ä¿¡æ¯
    const tenant = await context.app.service('tenants').find({
      query: { api_key: apiKey }
    });

    if (!tenant.data.length) {
      throw new Error('Invalid API key');
    }

    // è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡
    context.params.tenant = tenant.data[0];
    
    // è‡ªåŠ¨æ·»åŠ tenant_idè¿‡æ»¤
    if (context.method === 'find' || context.method === 'get') {
      context.params.query.tenant_id = tenant.data[0].id;
    }
    
    if (context.method === 'create') {
      context.data.tenant_id = tenant.data[0].id;
    }

    return context;
  };
};

module.exports = multiTenant;
```

#### 3.2.3 æœåŠ¡æ”¹é€ 

```javascript
// src/services/messages/messages.hooks.js
const multiTenant = require('../../hooks/multi-tenant');
const quotaCheck = require('../../hooks/quota-check');

module.exports = {
  before: {
    all: [multiTenant()],
    find: [],
    get: [],
    create: [quotaCheck()],
    update: [],
    patch: [],
    remove: []
  },

  after: {
    all: [],
    find: [],
    get: [],
    create: [broadcastMessage()],
    update: [],
    patch: [],
    remove: []
  }
};
```

### 3.3 Phase 3: é…é¢ç®¡ç†ç³»ç»Ÿ (1å‘¨)

```javascript
// src/hooks/quota-check.js
const Redis = require('redis');
const redis = Redis.createClient(process.env.REDIS_URL);

const quotaCheck = () => {
  return async (context) => {
    const tenant = context.params.tenant;
    const maxMessages = tenant.settings.maxMessages || 10000;
    
    // æ£€æŸ¥å½“æœˆé…é¢
    const currentMonth = new Date().toISOString().slice(0, 7);
    const key = `quota:messages:${tenant.id}:${currentMonth}`;
    
    const currentCount = await redis.get(key) || 0;
    
    if (parseInt(currentCount) >= maxMessages) {
      throw new Error('Message quota exceeded');
    }
    
    // å¢åŠ è®¡æ•°
    await redis.incr(key);
    await redis.expire(key, 60 * 60 * 24 * 32); // 32å¤©è¿‡æœŸ
    
    return context;
  };
};

module.exports = quotaCheck;
```

### 3.4 Phase 4: APIæ ‡å‡†åŒ– (1å‘¨)

```javascript
// src/services/api/v1/messages.js
const { Service } = require('feathers-memory');

class MessagesAPIService extends Service {
  async create(data, params) {
    // æ ‡å‡†åŒ–è¾“å…¥æ ¼å¼
    const message = {
      conversationId: data.conversationId,
      senderId: data.senderId,
      type: data.type,
      content: data.content,
      replyToId: data.replyToId
    };

    // è°ƒç”¨åŸå§‹æ¶ˆæ¯æœåŠ¡
    return await this.app.service('messages').create(message, params);
  }

  async find(params) {
    const { conversationId, page = 1, limit = 50, before } = params.query;
    
    const query = {
      conversationId,
      ...(before && { createdAt: { $lt: before } })
    };

    const result = await this.app.service('messages').find({
      ...params,
      query,
      paginate: {
        default: limit,
        max: 100
      }
    });

    // æ ‡å‡†åŒ–è¾“å‡ºæ ¼å¼
    return {
      success: true,
      data: {
        messages: result.data,
        pagination: {
          page: parseInt(page),
          limit: parseInt(limit),
          total: result.total,
          hasMore: (page * limit) < result.total
        }
      }
    };
  }
}

module.exports = MessagesAPIService;
```

### 3.5 Phase 5: SDKå¼€å‘ (2å‘¨)

#### 3.5.1 JavaScript SDK

```typescript
// packages/sdk-js/src/messagecore-sdk.ts
import io from 'socket.io-client';

export class MessageCoreSDK {
  private apiKey: string;
  private baseUrl: string;
  private socket: any;

  constructor(config: { apiKey: string; baseUrl?: string }) {
    this.apiKey = config.apiKey;
    this.baseUrl = config.baseUrl || 'https://api.messagecore.goldsky.com';
  }

  // åŸºäºFeathers.jså®¢æˆ·ç«¯æ”¹é€ 
  async connect(userToken: string) {
    this.socket = io(this.baseUrl, {
      auth: {
        apiKey: this.apiKey,
        token: userToken
      }
    });

    return new Promise((resolve, reject) => {
      this.socket.on('connect', resolve);
      this.socket.on('connect_error', reject);
    });
  }

  async sendMessage(data: any) {
    return await this.socket.emit('create', 'messages', data);
  }

  async getMessages(conversationId: string, options: any = {}) {
    return await this.socket.emit('find', 'api/v1/messages', {
      conversationId,
      ...options
    });
  }

  on(event: string, callback: Function) {
    this.socket.on(event, callback);
  }
}
```

#### 3.5.2 Flutter SDK

```dart
// packages/sdk-flutter/lib/messagecore_sdk.dart
import 'package:socket_io_client/socket_io_client.dart' as IO;
import 'package:http/http.dart' as http;

class MessageCoreSDK {
  final String apiKey;
  final String baseUrl;
  IO.Socket? _socket;

  MessageCoreSDK({
    required this.apiKey,
    this.baseUrl = 'https://api.messagecore.goldsky.com',
  });

  Future<void> connect(String userToken) async {
    _socket = IO.io(baseUrl, IO.OptionBuilder()
        .setAuth({
          'apiKey': apiKey,
          'token': userToken,
        })
        .build());

    _socket?.connect();
  }

  Future<Map<String, dynamic>> sendMessage(Map<String, dynamic> data) async {
    final completer = Completer<Map<String, dynamic>>();
    
    _socket?.emitWithAck('create', ['messages', data], ack: (response) {
      completer.complete(response);
    });
    
    return completer.future;
  }

  void onMessage(Function(Map<String, dynamic>) callback) {
    _socket?.on('messages created', (data) {
      callback(data);
    });
  }
}
```

### 3.6 Phase 6: ç®¡ç†åå°å¼€å‘ (2å‘¨)

```typescript
// apps/admin/src/services/api.ts
import { MessageCoreSDK } from '@goldsky/messagecore-sdk-js';

class AdminAPI {
  private sdk: MessageCoreSDK;

  constructor() {
    this.sdk = new MessageCoreSDK({
      apiKey: process.env.REACT_APP_ADMIN_API_KEY!,
      baseUrl: process.env.REACT_APP_API_URL!
    });
  }

  async getTenants() {
    return await this.sdk.socket.emit('find', 'tenants');
  }

  async createTenant(data: any) {
    return await this.sdk.socket.emit('create', 'tenants', data);
  }

  async getTenantUsage(tenantId: string) {
    return await this.sdk.socket.emit('find', 'quota-usage', {
      tenantId
    });
  }
}
```

## 4. é›†æˆæ­¥éª¤

### 4.1 Step 1: ç¯å¢ƒå‡†å¤‡

```bash
# 1. åˆ›å»ºå·¥ä½œç›®å½•
mkdir messagecore-project
cd messagecore-project

# 2. å…‹éš†Feathers.jsèŠå¤©æ¨¡æ¿
git clone https://github.com/feathersjs/feathers-chat.git backend
cd backend

# 3. å®‰è£…ä¾èµ–
npm install

# 4. æ·»åŠ é¢å¤–ä¾èµ–
npm install @prisma/client prisma redis ioredis uuid
npm install -D @types/uuid

# 5. åˆå§‹åŒ–æ•°æ®åº“
npx prisma init
```

### 4.2 Step 2: é¡¹ç›®ç»“æ„é‡ç»„

```bash
messagecore-project/
â”œâ”€â”€ backend/                 # Feathers.jsåç«¯ (æ”¹é€ )
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ tenants/     # æ–°å¢ç§Ÿæˆ·æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ quota/       # æ–°å¢é…é¢æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ api/         # æ–°å¢æ ‡å‡†åŒ–API
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ multi-tenant.js
â”‚   â”‚   â”‚   â””â”€â”€ quota-check.js
â”‚   â”‚   â””â”€â”€ prisma/
â”‚   â”‚       â””â”€â”€ schema.prisma
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ sdk-js/              # JavaScript SDK
â”‚   â”œâ”€â”€ sdk-flutter/         # Flutter SDK
â”‚   â””â”€â”€ shared/              # å…±äº«ç±»å‹å®šä¹‰
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ admin/               # Reactç®¡ç†åå°
â”‚   â””â”€â”€ docs/                # æ–‡æ¡£ç«™ç‚¹
â””â”€â”€ README.md
```

### 4.3 Step 3: æ•°æ®åº“è¿ç§»

```prisma
// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id        String   @id @default(uuid())
  name      String
  subdomain String   @unique
  apiKey    String   @unique @map("api_key")
  planType  String   @default("basic") @map("plan_type")
  settings  Json     @default("{}")
  status    String   @default("active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users     User[]
  messages  Message[]

  @@map("tenants")
}

model User {
  id             String  @id @default(uuid())
  tenantId       String  @map("tenant_id")
  externalUserId String  @map("external_user_id")
  email          String?
  displayName    String  @map("display_name")
  avatarUrl      String? @map("avatar_url")
  isActive       Boolean @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")

  tenant   Tenant    @relation(fields: [tenantId], references: [id])
  messages Message[]

  @@unique([tenantId, externalUserId])
  @@map("users")
}

model Message {
  id             String   @id @default(uuid())
  tenantId       String   @map("tenant_id")
  conversationId String   @map("conversation_id")
  senderId       String   @map("sender_id")
  messageType    String   @map("message_type")
  content        Json
  replyToId      String?  @map("reply_to_id")
  status         String   @default("sent")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  tenant Tenant @relation(fields: [tenantId], references: [id])
  sender User   @relation(fields: [senderId], references: [id])

  @@index([tenantId, conversationId, createdAt])
  @@map("messages")
}
```

### 4.4 Step 4: æ ¸å¿ƒæœåŠ¡æ”¹é€ 

```javascript
// backend/src/services/tenants/tenants.service.js
const { Service } = require('feathers-prisma');
const { PrismaClient } = require('@prisma/client');

class TenantsService extends Service {
  constructor(options, app) {
    super(options, app);
    this.prisma = new PrismaClient();
  }

  async create(data, params) {
    const apiKey = this.generateApiKey();
    
    const tenant = await this.prisma.tenant.create({
      data: {
        ...data,
        apiKey,
        settings: {
          maxUsers: this.getMaxUsers(data.planType),
          maxMessages: this.getMaxMessages(data.planType),
          ...data.settings
        }
      }
    });

    return tenant;
  }

  generateApiKey() {
    return 'mc_' + require('uuid').v4().replace(/-/g, '');
  }

  getMaxUsers(planType) {
    const limits = { basic: 100, pro: 1000, enterprise: 10000 };
    return limits[planType] || limits.basic;
  }

  getMaxMessages(planType) {
    const limits = { basic: 10000, pro: 100000, enterprise: 1000000 };
    return limits[planType] || limits.basic;
  }
}

module.exports = TenantsService;
```

## 5. å¿«é€Ÿå¯åŠ¨

### 5.1 ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# scripts/quick-setup.sh

echo "ğŸš€ GoldSky MessageCoreå¿«é€Ÿå¯åŠ¨è„šæœ¬"

# 1. å…‹éš†Feathers.jsåŸºç¡€é¡¹ç›®
echo "ğŸ“¦ å…‹éš†åŸºç¡€é¡¹ç›®..."
git clone https://github.com/feathersjs/feathers-chat.git messagecore-backend
cd messagecore-backend

# 2. å®‰è£…ä¾èµ–
echo "ğŸ“š å®‰è£…ä¾èµ–..."
npm install
npm install @prisma/client prisma redis ioredis uuid express-rate-limit

# 3. è®¾ç½®ç¯å¢ƒå˜é‡
echo "âš™ï¸ é…ç½®ç¯å¢ƒ..."
cp .env.example .env
echo "DATABASE_URL=postgresql://username:password@localhost:5432/messagecore" >> .env
echo "REDIS_URL=redis://localhost:6379" >> .env

# 4. æ•°æ®åº“åˆå§‹åŒ–
echo "ğŸ—„ï¸ åˆå§‹åŒ–æ•°æ®åº“..."
npx prisma generate
npx prisma db push

# 5. å¯åŠ¨æœåŠ¡
echo "ğŸ¯ å¯åŠ¨æœåŠ¡..."
npm run dev

echo "âœ… GoldSky MessageCoreå¯åŠ¨å®Œæˆ!"
echo "ğŸ“– APIæ–‡æ¡£: http://localhost:3030"
echo "ğŸ”§ ç®¡ç†åå°: http://localhost:3000"
```

### 5.2 Dockerå¿«é€Ÿéƒ¨ç½²

```yaml
# docker-compose.quick.yml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: messagecore
      POSTGRES_USER: messagecore
      POSTGRES_PASSWORD: changeme
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  messagecore-api:
    build: ./backend
    environment:
      DATABASE_URL: postgresql://messagecore:changeme@postgres:5432/messagecore
      REDIS_URL: redis://redis:6379
    ports:
      - "3030:3030"
    depends_on:
      - postgres
      - redis
    volumes:
      - ./backend:/app
    command: npm run dev

volumes:
  postgres_data:
```

### 5.3 æµ‹è¯•éªŒè¯

```javascript
// test/integration.test.js
const assert = require('assert');
const axios = require('axios');

describe('GoldSky MessageCore APIæµ‹è¯•', () => {
  let apiKey;
  
  before(async () => {
    // åˆ›å»ºæµ‹è¯•ç§Ÿæˆ·
    const tenant = await axios.post('http://localhost:3030/tenants', {
      name: 'æµ‹è¯•å…¬å¸',
      subdomain: 'test-company',
      planType: 'basic'
    });
    
    apiKey = tenant.data.apiKey;
  });

  it('åº”è¯¥èƒ½å¤Ÿå‘é€æ¶ˆæ¯', async () => {
    const response = await axios.post(
      'http://localhost:3030/api/v1/messages/send',
      {
        conversationId: 'conv-123',
        senderId: 'user-456',
        type: 'text',
        content: { text: 'Hello MessageCore!' }
      },
      {
        headers: { 'X-API-Key': apiKey }
      }
    );

    assert.equal(response.data.success, true);
    assert.equal(response.data.data.content.text, 'Hello MessageCore!');
  });
});
```

## 6. é¢„æœŸæ”¶ç›Š

### 6.1 å¼€å‘æ—¶é—´å¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | ä»é›¶å¼€å‘ | åŸºäºå¼€æº | æ—¶é—´èŠ‚çœ |
|----------|----------|----------|----------|
| åŸºç¡€æ¶æ„ | 4å‘¨ | 1å‘¨ | 75% |
| å®æ—¶é€šä¿¡ | 3å‘¨ | 0.5å‘¨ | 83% |
| è®¤è¯ç³»ç»Ÿ | 2å‘¨ | 0.5å‘¨ | 75% |
| APIå¼€å‘ | 4å‘¨ | 2å‘¨ | 50% |
| SDKå¼€å‘ | 3å‘¨ | 2å‘¨ | 33% |
| **æ€»è®¡** | **16å‘¨** | **6å‘¨** | **62.5%** |

### 6.2 è´¨é‡ä¼˜åŠ¿

```yaml
ç¨³å®šæ€§:
  - Feathers.jså·²åœ¨ç”Ÿäº§ç¯å¢ƒéªŒè¯
  - Socket.ioå¤„ç†å¹¶å‘è¿æ¥èƒ½åŠ›å¼º
  - å‡å°‘è‡ªç ”é£é™©

æ‰©å±•æ€§:
  - Feathers.jsæ’ä»¶ç”Ÿæ€ä¸°å¯Œ
  - æ”¯æŒå¤šç§æ•°æ®åº“
  - æ˜“äºæ°´å¹³æ‰©å±•

ç»´æŠ¤æ€§:
  - æ ‡å‡†åŒ–æ¶æ„
  - æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒ
  - è¯¦ç»†çš„æ–‡æ¡£
```

### 6.3 æˆæœ¬ä¼˜åŒ–

```yaml
äººåŠ›æˆæœ¬: 
  - åŸéœ€4äººÃ—4æœˆ = 16äººæœˆ
  - ç°éœ€3äººÃ—2æœˆ = 6äººæœˆ
  - èŠ‚çœæˆæœ¬: 62.5%

æ—¶é—´æˆæœ¬:
  - åŸè®¡åˆ’16å‘¨ä¸Šçº¿
  - ç°6-8å‘¨å³å¯ä¸Šçº¿
  - æå‰2ä¸ªæœˆæŠ¢å å¸‚åœº

æŠ€æœ¯é£é™©:
  - åŸºäºæˆç†Ÿå¼€æºé¡¹ç›®
  - é™ä½æŠ€æœ¯é€‰å‹é£é™©
  - å¿«é€Ÿè¿­ä»£éªŒè¯
```

## æ€»ç»“

é€šè¿‡åŸºäºFeathers.jsæ”¹é€ ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **å¿«é€Ÿå¯åŠ¨**: 1å‘¨å†…æ­å»ºåŸºç¡€æ¶æ„
2. **æˆæœ¬æ§åˆ¶**: å¼€å‘æ—¶é—´èŠ‚çœ62.5%  
3. **è´¨é‡ä¿è¯**: åŸºäºç”Ÿäº§çº§å¼€æºé¡¹ç›®
4. **çµæ´»æ‰©å±•**: ä¿æŒå®Œå…¨çš„å®šåˆ¶èƒ½åŠ›

è¿™ä¸ªæ–¹æ¡ˆæ—¢æ»¡è¶³äº†å¿«é€Ÿä¸Šçº¿çš„éœ€æ±‚ï¼Œåˆä¿è¯äº†äº§å“çš„è´¨é‡å’Œå¯æ‰©å±•æ€§ï¼Œæ˜¯æœ€ä¼˜çš„æŠ€æœ¯é€‰æ‹©ã€‚ 
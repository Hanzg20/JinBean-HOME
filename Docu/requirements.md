# Requirements Document

> 本文件为 JinBean 产品需求主文档，详见项目根目录 README.md 的文档使用规范。

## 1. 项目背景与目标
JinBean 致力于为海外华人及本地居民提供便捷高效的生活服务，集成预约服务、工具租赁、社区互动等功能，打造可扩展的超级应用。

## 2. 目标用户与利益相关者
- 终端用户（服务消费者/服务提供者）
- 产品经理
- 开发团队
- 后端服务团队
- UI/UX 设计师

## 3. 功能需求
### 3.1 用户注册/登录/认证
- 邮箱注册、登录、密码找回
- 第三方登录（Google/Apple，未来可扩展微信）
- 多语言支持

### 3.2 个人资料与地址管理
- 编辑头像、昵称、联系方式、简介
- 地址簿管理（增删改查、默认地址）
- 历史订单、收藏夹
- 角色切换入口

### 3.3 服务预约与下单
- 服务分类浏览与筛选
- 服务者信息与报价展示
- 服务时间选择与预约
- 安全支付（Stripe/微信）
- 订单状态跟踪与历史查询

### 3.4 工具租赁
- 工具列表、预约时间段
- 押金冻结与归还
- 工具归还确认

### 3.5 社区动态
- 多语言发帖、内容优先显示
- 点赞、评论、举报、附图、定位
- 原文/翻译切换

### 3.6 插件化机制
- 各功能模块插件注册与管理
- 动态启用/禁用、独立控制器与状态

### 3.7 角色与主题切换
- 用户/服务者角色切换
- 主题 per-role 记忆与切换

### 3.8 多语言支持
- UI/内容多语言切换
- UGC/平台内容多语言字段
- 自动翻译与原文切换

### 3.9 客服与反馈
- 意见反馈表单
- 在线客服/邮件支持

### 3.10 搜索与推荐
- 全局关键词搜索
- 智能推荐服务/工具/动态

## 4. 非功能需求
- 性能：启动快、页面切换流畅
- 可扩展性：插件化架构、易于新增功能
- 可维护性：模块解耦、文档完善
- 安全性：认证、数据加密、权限控制
- 国际化：多语言、时区、货币适配

## 5. 业务流程/用户故事
- 典型用户注册、登录、预约服务、下单、评价、切换角色等流程
- 服务者注册、资料完善、服务发布、接单、订单管理等流程
- 业务流程图/用例见系统设计文档

## 6. 需求优先级与范围
- MVP：注册/登录、服务预约、订单、个人资料、社区、插件机制、基础多语言
- 1.0：工具租赁、角色切换、主题切换、支付、客服、推荐
- 2.0+：第三方登录、AI推荐、更多插件、后台管理、国际支付等

## 7. 其它说明
- 详细技术实现、架构、数据流、API 见 system_design.md
- 需求变更与优先级调整由产品经理与团队协商决定

# 金豆荚App - 详细项目需求文档

*1.1 项目名称：**
金豆荚 JinBeanPod App

**1.2 项目目标：**
本项目的核心目标是开发一款创新的移动应用，为海外华人及本地居民提供便捷高效的便民生活服务。通过集成预约服务、工具租赁、信息发布与社区互动等功能，金豆荚旨在成为用户日常生活中不可或缺的超级应用。其独特的插件化机制将确保系统的高度可扩展性和灵活性，以适应未来不断增长的服务需求和市场变化。

**1.3 目标用户：**
*   **海外华人及本地居民：** 作为主要服务对象，应用将提供多语言支持，以满足不同文化背景用户的沟通和服务需求。
*   **居民用户（普通服务消费者）：** 需要日常便民服务（如家政、维修、搬运等）或工具租赁的个人或家庭。
*   **服务提供者（草坪工、搬运工、保洁工等）：** 具备特定技能并希望通过平台提供服务的个人或小型团队。

---

### 二、核心功能模块

**2.1 登录/注册**
*   **邮箱注册与登录：** 提供标准的电子邮件和密码注册及登录流程，支持密码找回功能。
*   **第三方登录：** 集成主流的第三方身份验证服务，包括 Google 账户和 Apple ID 登录，未来可扩展微信登录。
*   **密码重置：** 用户可以通过邮箱接收重置密码的链接或验证码。
*   **多语言支持：** 所有登录和注册相关的界面元素、提示信息和错误消息都将支持多语言显示。

**2.2 用户中心**
*   **编辑个人信息：** 允许用户修改头像、昵称、联系方式、个人简介等基本信息。
*   **地址簿管理：** 用户可以添加、编辑、删除多个常用地址，并设置默认地址，便于服务预约和工具租赁。
*   **历史订单、收藏夹：** 用户可以查看过去的服务预约和工具租赁订单详情，管理收藏的服务或工具列表。
*   **切换用户角色：** 提供用户和（未来的）服务者角色切换入口，方便用户管理不同角色下的信息和功能。

**2.3 服务预约**
*   **选择服务分类：** 用户可以根据需求浏览不同的服务类别，例如换胎、割草、保洁、维修、搬运等。
*   **浏览服务者信息与报价：** 展示服务提供者的详细信息（如评分、评论、服务范围、资质）及其提供的各项服务报价。
*   **服务时间选择：** 提供直观的时间选择器，用户可以根据服务者的可用时间段进行预约。
*   **支付：** 集成安全的支付网关，支持主流支付方式如 Stripe 和微信支付（通过 Flutter 插件实现）。
*   **查看订单状态与历史记录：** 用户可以实时跟踪当前订单状态（待付款、待服务、进行中、已完成、待评价、退款/售后），并查询历史订单详情。

**2.4 工具租赁**
*   **工具展示、可预约时间段：** 以清晰的界面展示可供租赁的工具列表，包括工具图片、描述、日租/时租价格以及可预约的时间段。
*   **押金冻结与归还处理：** 支持租赁押金的在线冻结和工具归还后的自动解冻/归还流程。
*   **工具归还确认流程：** 确保工具归还时有明确的确认机制，例如服务提供者确认、照片上传等。

**2.5 社区动态 **
*   **发帖支持中/英/法多语言字段：** 用户发布动态时，可以为内容添加多语言字段（如 `content_zh`, `content_en`, `content_fr`），以支持多语言内容创作。
*   **系统根据用户语言偏好优先显示匹配语言内容：** 应用将根据当前用户设置的语言偏好，优先显示帖子内容中匹配的语言版本。
*   **无对应语言内容时显示原文或翻译内容（标注自动翻译）：** 如果帖子没有当前用户语言的内容，系统将显示帖子的原始语言内容，或提供由机器自动翻译的内容并进行明确标注。
*   **点赞、评论、举报、附图与定位功能：** 提供丰富的社区互动功能，包括对帖子进行点赞、发表评论、举报不当内容、上传图片和附加地理位置信息。
*   **可切换查看其他语言内容（"显示原文"）：** 用户可以点击按钮（例如"显示英文原文"）来查看帖子的其他可用语言版本。

**2.6 应用内搜索**
*   **按关键词查找服务、工具、用户动态等：** 提供全局搜索功能，允许用户通过关键词快速查找所需的服务、租赁工具、金豆圈内的用户动态以及其他相关信息。

**2.7 多语言支持**
*   **UI 多语言切换：** 应用界面所有文本、标签、按钮等元素均支持中文、英文、法文等多语言的实时切换。
*   **所有内容支持多语言字段结构：** 针对用户生成内容 (UGC) 和平台发布内容，采用多语言字段存储结构（例如 `title_zh`, `title_en`, `title_fr`），确保内容的国际化呈现。
*   **自动翻译建议缓存字段供英文用户浏览：** 对于非英文内容的帖子，系统可以生成自动翻译版本并缓存 (`content_translated_en`)，以提高英文用户的浏览体验，同时保留切换查看原文的选项。

**2.8 客服反馈**
*   **填写意见反馈：** 用户可以填写表单提交对应用的意见、建议或遇到的问题。
*   **与平台客服联系：** 提供在线客服聊天功能或通过邮件直接联系平台支持。

**2.9 插件化机制与扩展支持**
*   **每个功能模块（如服务预约、工具租赁、金豆圈等）作为独立插件进行注册与管理：** 核心功能被设计为可插拔的模块，便于独立开发、测试和部署。
*   **插件通过注册机制挂载到底部导航或特定页面容器中：** 插件可以灵活地集成到应用的导航栏、特定功能页面或动态加载的容器中。
*   **插件支持独立控制器与状态存储，便于动态加载与按需集成：** 每个插件拥有自己的控制器和状态管理，确保模块间的松耦合，支持按需加载和卸载，优化应用性能和资源占用。
*   **插件元数据（如图标、名称、是否启用）统一由后端配置，支持运营灵活启用/停用功能：** 插件的可见性、名称、图标等配置通过后端管理，运营人员可以根据市场策略或功能测试灵活地启用、禁用或调整插件。
*   **插件能力可扩展：** 架构支持未来轻松添加新的功能模块作为插件，例如新增"跑腿服务"、"物品共享"、"技能交易"等。

---

### 三、系统框架描述

**3.1 客户端 Flutter App**
*   **开发框架：** Flutter 3.x，支持 iOS 和 Android 跨平台开发。
*   **状态管理 / 路由 / 国际化：** GetX 框架，提供响应式状态管理、依赖注入、声明式路由管理和多语言解决方案。
*   **响应式布局：** `flutter_screenutil` 用于实现屏幕适配和响应式 UI 设计，确保在不同尺寸设备上的良好显示效果。
*   **多语言库：** `flutter_localizations` 提供 Flutter 框架级别的国际化支持。
*   **插件模块化机制：** 通过 GetX 路由的注入机制和控制器之间的隔离，实现功能模块的插件化。

**3.2 后端 Supabase 服务**
*   **身份验证 (Auth)：** 利用 Supabase 的身份验证服务，支持多种登录方式（邮件、OAuth）。
*   **数据库 (Postgres)：** 使用 Supabase 提供的 PostgreSQL 数据库作为主要数据存储，支持强大的关系型数据管理和查询能力。
*   **存储 (Storage)：** 采用 Supabase Storage 服务进行图片、视频等用户生成内容的存储和管理。
*   **边缘函数 (Function API)：** 可利用 Supabase Edge Functions 实现轻量级、可扩展的后端逻辑。
*   **数据库迁移管理：** 结合 Supabase CLI 工具，对数据库 schema 变更进行版本控制和迁移管理。

**3.3 支付**
*   **Stripe：** 集成 Stripe 支付平台，支持信用卡等多种国际支付方式。
*   **微信支付 SDK：** 通过 Flutter 插件形式集成微信支付 SDK，方便中国用户进行支付。

**3.4 后台管理系统**
*   **技术选型：** 可选用 AdminJS 或基于 Vue + Supabase 自定义开发。
*   **主要功能：**
    *   **服务管理：** 增删改查服务类别、服务详情、服务者信息。
    *   **用户管理：** 查看、编辑用户信息、角色管理、封禁用户。
    *   **评价归纳：** 审核和管理用户对服务及工具的评价。
    *   **文本多语言配置：** 集中管理应用内所有多语言文本的键值对。
    *   **插件控制开关：** 运营人员可以通过后台系统动态启用或停用前端插件模块。

---

### 四、界面 UI 原型描述

**4.1 开场页 (Splash Screen)**
*   **视觉呈现：** 应用启动时显示全屏 App Logo，并伴随流畅的动画效果，持续约 3 秒。
*   **流程引导：** 动画结束后，自动跳转到登录或注册页面，引导用户进入应用。

**4.2 首页流程 (Bottom Tab)**
*   **底部导航栏：** 包含"首页"、"服务"、"金豆圈"、"社区"、"我的"等主要功能模块入口。
*   **首页 (Home Tab)：**
    *   **Banner 轮播图：** 位于页面顶部，展示最新活动、推荐服务或重要通知。
    *   **服务类别绘图四格分配：** 采用简洁的四格布局，以图标和文字形式展示核心服务类别，如"换胎"、"家政"、"租赁"、"其他"，点击进入对应服务列表。
    *   **社区福利（活动/资讯卡片列表）：** 展示金豆圈或社区模块中的精选活动、优惠信息或资讯，以卡片流形式呈现。
    *   **热门服务推荐：** 基于用户好评、附近地理位置或高频使用的服务进行智能推荐，以列表或网格形式展示。

**4.3 服务页 (Services Page)**
*   **服务搜索：** 顶部提供服务关键词搜索框，方便用户快速定位服务。
*   **服务分类筛选：** 列表或网格形式展示各类服务分类，配以图标和类别名称，点击可筛选。
*   **服务列表：** 以卡片或列表项形式展示服务概要，包括服务名称、简要描述、价格、用户评分和主要服务者信息。
*   **服务详情页：** 点击服务列表项进入，展示服务的完整描述、详细价格明细、服务者资质，以及可预约的时间选择器 (`Date Picker`)。
*   **预约按钮：** 服务详情页底部提供"预约"按钮，用户点击后发起订单流程。
*   **工具租赁模块：** 以 Grid 视图展示可供租赁的工具，用户可以选择租赁时长、预约支付，并有明确的押金处理说明。

**4.4 社区页 (Community Page)**
*   **社区福利资讯卡片流：** 呈现金豆圈中的各类活动、补贴、通知等资讯，以可滚动的卡片流形式展示，支持内容根据用户语言偏好显示。
*   **分类筛选：** 提供"活动"、"补贴"、"通知"等分类标签，用户可以进行筛选，查看特定类型的资讯。

**4.5 金豆圈 UI**
*   **动态展示：** 每个帖子（动态）以卡片形式展示，包含用户头像、昵称、发帖内容、附带图片和地理位置信息。
*   **多语言内容显示：** 发帖内容将根据用户语言偏好优先显示对应的多语言字段。
*   **互动功能：** 提供点赞、评论、转发按钮，支持用户对帖子进行互动。
*   **语言切换按钮：** 对于多语言内容，提供如"显示英文原文"等按钮，允许用户在不同语言版本之间切换。

**4.6 我的页面 (My Page/Profile Page)**
*   **用户信息展示：** 页面顶部显示用户头像、昵称，并提供编辑入口。
*   **账户信息编辑：** 包含个人资料编辑的入口。
*   **我的订单：** 汇总服务订单和工具租赁订单的列表。
*   **收藏服务：** 展示用户收藏的服务列表。
*   **切换角色按钮：** 提供用户和（未来的）服务者角色之间的切换功能。
*   **语言切换：** 提供语言切换的入口，允许用户更改应用界面语言。

---

### 五、特殊需求

*   **插件注册表管理各功能模块可插拔性：** 建立一个中心化的插件注册表，用于管理所有功能模块（插件）的生命周期、元数据和集成点，确保应用的高度可插拔性和动态扩展能力。
*   **接口设计方便后期接 AI 推荐、智能搭配、自动匹配服务者：** API 接口设计应具备灵活性和可扩展性，为未来集成 AI 驱动的个性化推荐、服务智能搭配和基于算法的服务者自动匹配功能预留接口。
*   **支持推送通知：** 集成推送通知服务（如 FCM 或 Supabase Edge Functions），实现订单状态更新、新消息、社区活动等实时通知功能。
*   **实时评价刷新：** 确保用户对服务或工具的评价能够实时更新并反映在服务者或工具的详情页面上。
*   **系统支持联合资深后台 SaaS 服务：** 考虑与专业的后台 SaaS 服务（例如 CRM、工单系统、营销自动化工具）进行集成，以增强平台的运营和管理能力。
*   **社区内容语言一致性机制：**
    *   **支持用户根据语言喜好自动筛选内容：** 社区内容流可以根据用户的语言偏好进行智能筛选，优先显示用户熟悉或感兴趣的语言内容。
    *   **多语言字段存储与显示：** 所有社区发布内容均采用多语言字段（如 `body_zh`, `body_en`）存储，确保内容在不同语言环境下的原生显示。
    *   **自动翻译后缓存机制 + 原文切换：** 对于非用户首选语言的内容，系统将提供自动翻译服务，并将翻译结果进行缓存，以减少重复翻译的开销。同时，用户始终可以切换查看内容的原始语言版本。

### 1.3 范围
本阶段项目范围包括以下核心功能：
*   增强型启动欢迎页（Splash Welcome Page）。
*   用户登录与注册（含邮箱/密码及社交登录UI）。
*   底部导航栏及其承载的四个主要功能模块：首页、服务、社区、个人中心。
*   各功能模块的基本UI展示和 mock 数据集成。
*   多语言切换能力（英语和中文）。

## 2. 利益相关者

*   **终端用户**: 金豆荚App的日常使用者，期望获得便捷、高效的服务体验。
*   **产品经理**: 负责定义和完善App的功能与用户体验。
*   **开发团队**: 负责App的设计、开发与维护。
*   **后端服务提供商/团队**: 提供认证、数据存储和业务逻辑API（当前阶段为Mock）。
*   **Figma 设计师**: 提供App的UI/UX设计稿。

## 3. 功能需求 (Functional Requirements)

### 3.1 启动与认证模块 (Auth Plugin)

*   **RQ-AUTH-001**: 应用启动时，应显示一个带有品牌Logo、欢迎语及动画效果的启动欢迎页。
*   **RQ-AUTH-002**: 启动页加载完成后，应显示"Sign In"和"Sign Up"按钮，供用户选择进入登录或注册流程。
*   **RQ-AUTH-003**: 登录页面应提供邮箱/密码输入字段，并支持密码显示/隐藏切换。
*   **RQ-AUTH-004**: 登录页面应提供"Google Sign In"和"Apple Sign In"按钮（UI已实现，功能待集成）。
*   **RQ-AUTH-005**: 用户可以通过邮箱和密码进行注册，注册成功后应导航至登录页面。
*   **RQ-AUTH-006**: 应用应能持久化用户的登录状态，已登录用户直接进入主应用界面。
*   **RQ-AUTH-007**: 用户应能通过个人中心页面的"Logout"按钮安全退出登录。

### 3.2 插件管理系统 (Plugin Management)

*   **RQ-PM-001**: 系统应具备插件注册机制，能够识别和加载不同的功能模块（如 Auth, Home, Service, Community, Profile）。
*   **RQ-PM-002**: 系统应能根据配置（当前为硬编码，未来可来自后端）动态启用或禁用特定插件。
*   **RQ-PM-003**: 底部导航栏应根据启用的底部导航类型插件动态生成。
*   **RQ-PM-004**: 每个插件应能定义自己的路由、绑定和入口Widget。

### 3.3 主应用壳 (ShellApp)

*   **RQ-SHELL-001**: 主应用壳应包含一个底部导航栏，用于切换不同的底部标签页插件。
*   **RQ-SHELL-002**: 底部导航栏应显示插件元数据中定义的图标和简短名称。
*   **RQ-SHELL-003**: 切换底部标签页时，应保持已加载页面的状态。

### 3.4 首页模块 (Home Plugin)

*   **RQ-HOME-001**: 首页应展示用户欢迎信息（例如用户邮箱）。
*   **RQ-HOME-002**: 首页应包含通知列表。
*   **RQ-HOME-003**: 首页应展示社区活动和推荐服务卡片（当前为Mock数据）。
*   **RQ-HOME-004**: 首页应提供"Logout"按钮，方便用户退出登录。

### 3.5 服务预约模块 (Service Booking Plugin)

*   **RQ-SERVICE-001**: 服务页面应包含一个搜索栏。
*   **RQ-SERVICE-002**: 服务页面应展示可过滤的服务类别（例如"居家服务"、"美容健康"等）。
*   **RQ-SERVICE-003**: 服务页面应展示热门服务列表，包含名称、描述、价格、图片、评分和评论数（当前为Mock数据）。

### 3.6 社区模块 (Community Plugin)

*   **RQ-COMM-001**: 社区页面应包含一个自定义的AppBar，带有标题。
*   **RQ-COMM-002**: 社区页面应包含一个Tab Bar，用于过滤不同类型的社区帖子（例如"活动"、"补贴"、"公告"）。
*   **RQ-COMM-003**: 社区页面应展示社区帖子列表，包含标题、描述、图片、作者和时间戳等信息（当前为Mock数据）。

### 3.7 个人中心模块 (Profile Plugin)

*   **RQ-PROFILE-001**: 个人中心页面应展示用户头像、用户名和注册时间（当前为Mock数据）。
*   **RQ-PROFILE-002**: 个人中心页面应分节展示账户相关菜单项（如"编辑资料"、"订单历史"、"收藏服务"等）。
*   **RQ-PROFILE-003**: 个人中心页面应分节展示设置相关菜单项（如"语言"）。
*   **RQ-PROFILE-004**: 菜单项应支持点击事件（当前为打印日志，未来可导航到具体页面）。

## 4. 非功能需求 (Non-functional Requirements)

### 4.1 性能 (Performance)
*   **NFR-PERF-001**: 启动欢迎页面的动画应流畅，无卡顿。
*   **NFR-PERF-002**: 页面切换应迅速响应，无明显延迟。

### 4.2 可扩展性 (Scalability)
*   **NFR-SCALE-001**: 插件化架构应支持未来新增、移除或更新功能模块，而无需大规模修改核心代码。
*   **NFR-SCALE-002**: 业务逻辑和UI应解耦，便于独立扩展。

### 4.3 可维护性 (Maintainability)
*   **NFR-MAINT-001**: 代码应遵循Dart和Flutter的最佳实践，保持高可读性和一致性。
*   **NFR-MAINT-002**: 模块化结构应简化调试和问题定位。
*   **NFR-MAINT-003**: 依赖管理应清晰，便于更新和解决冲突。

### 4.4 可用性 (Usability)
*   **NFR-USABILITY-001**: 用户界面应与 Figma 设计稿保持高度一致。
*   **NFR-USABILITY-002**: 应用流程应直观易懂，提供良好的用户体验。

### 4.5 安全性 (Security - 当前阶段考虑)
*   **NFR-SEC-001**: 认证信息（如用户邮箱）应本地持久化。
*   **NFR-SEC-002**: 未来与真实后端集成时，应考虑数据加密和安全的认证授权机制（OAuth2, JWT等）。

### 4.6 国际化 (Internationalization)
*   **NFR-I18N-001**: 应用应支持英文和中文界面显示。
*   **NFR-I18N-002**: 所有面向用户的文本（包括底部导航栏名称）应通过国际化机制管理。

## 六、新增需求与业务说明（2024-07-03）

### 6.1 多角色用户登录与切换
- 支持 customer、provider、customer+provider 多角色用户。
- 登录页支持多角色用户选择角色，登录后进入对应主页面。
- profile 页支持角色切换，只有用户主动点击才切换。

### 6.2 provider 端独立导航
- provider 端采用独立 ProviderShellApp，彻底与插件式 tab 隔离。
- customer 端采用 ShellApp，动态 bottomTab。
- provider/customer 端主页面结构、导航、业务逻辑彻底隔离。

### 6.3 主题 per-role 记忆与切换
- 主题设置支持 per-role 记忆，切换角色自动切换主题。
- 支持 dark teal、golden 两套主题，所有 UI 颜色响应主题变化。

## 8. 开发优先级与任务分解

### 高优先级（核心功能/基础能力）
- 服务预约/下单/支付/订单管理端到端测试与优化
- 多角色（客户/服务商）切换与隔离体验完善
- 服务商注册、资料完善、服务发布/管理功能打磨
- 个人资料、地址管理、收藏、历史订单等基础功能完善
- 插件注册、动态加载、底部导航挂载机制优化
- 插件元数据后端配置与前端联动
- UI/内容多语言切换全流程测试
- 动态内容多语言字段、自动翻译、原文切换体验完善
- 主题 per-role 记忆与切换
- 响应式布局、动画、交互细节优化
- 统一色彩/字体/组件风格，消除硬编码
- 数据库结构与 RLS（行级安全）策略复查
- 主要表的索引、约束、数据字典补全
- 安全合规（加密、脱敏、备份、权限）方案落地

### 中优先级（增强与扩展）
- 工具租赁业务流程开发与测试
- 社区动态（发帖、评论、点赞、举报、图片、定位）功能完善
- Supabase Storage 文件上传、图片处理、权限控制
- 通知推送、消息中心、订单/服务状态变更提醒
- Google/Apple 登录集成与测试
- 管理端服务/用户/内容审核、插件开关、数据统计等

### 低优先级（优化与未来规划）
- 服务/内容推荐算法、个性化排序、智能匹配服务商
- Stripe/微信/国际支付适配
- 货币、时区、税务等国际化细节
- 单元/集成/UI 自动化测试
- CI/CD 流水线完善、自动部署、监控与日志
- 各模块开发文档、API 文档自动化生成
- 需求/设计/数据库/安全等文档持续完善

## 9. 其它说明
- 详细技术实现、架构、数据流、API 见 system_design.md
- 需求变更与优先级调整由产品经理与团队协商决定

# 金豆荚App - 详细项目需求文档

*1.1 项目名称：**
金豆荚 JinBeanPod App

**1.2 项目目标：**
本项目的核心目标是开发一款创新的移动应用，为海外华人及本地居民提供便捷高效的便民生活服务。通过集成预约服务、工具租赁、信息发布与社区互动等功能，金豆荚旨在成为用户日常生活中不可或缺的超级应用。其独特的插件化机制将确保系统的高度可扩展性和灵活性，以适应未来不断增长的服务需求和市场变化。

**1.3 目标用户：**
*   **海外华人及本地居民：** 作为主要服务对象，应用将提供多语言支持，以满足不同文化背景用户的沟通和服务需求。
*   **居民用户（普通服务消费者）：** 需要日常便民服务（如家政、维修、搬运等）或工具租赁的个人或家庭。
*   **服务提供者（草坪工、搬运工、保洁工等）：** 具备特定技能并希望通过平台提供服务的个人或小型团队。

---

### 二、核心功能模块

**2.1 登录/注册**
*   **邮箱注册与登录：** 提供标准的电子邮件和密码注册及登录流程，支持密码找回功能。
*   **第三方登录：** 集成主流的第三方身份验证服务，包括 Google 账户和 Apple ID 登录，未来可扩展微信登录。
*   **密码重置：** 用户可以通过邮箱接收重置密码的链接或验证码。
*   **多语言支持：** 所有登录和注册相关的界面元素、提示信息和错误消息都将支持多语言显示。

**2.2 用户中心**
*   **编辑个人信息：** 允许用户修改头像、昵称、联系方式、个人简介等基本信息。
*   **地址簿管理：** 用户可以添加、编辑、删除多个常用地址，并设置默认地址，便于服务预约和工具租赁。
*   **历史订单、收藏夹：** 用户可以查看过去的服务预约和工具租赁订单详情，管理收藏的服务或工具列表。
*   **切换用户角色：** 提供用户和（未来的）服务者角色切换入口，方便用户管理不同角色下的信息和功能。

**2.3 服务预约**
*   **选择服务分类：** 用户可以根据需求浏览不同的服务类别，例如换胎、割草、保洁、维修、搬运等。
*   **浏览服务者信息与报价：** 展示服务提供者的详细信息（如评分、评论、服务范围、资质）及其提供的各项服务报价。
*   **服务时间选择：** 提供直观的时间选择器，用户可以根据服务者的可用时间段进行预约。
*   **支付：** 集成安全的支付网关，支持主流支付方式如 Stripe 和微信支付（通过 Flutter 插件实现）。
*   **查看订单状态与历史记录：** 用户可以实时跟踪当前订单状态（待付款、待服务、进行中、已完成、待评价、退款/售后），并查询历史订单详情。

**2.4 工具租赁**
*   **工具展示、可预约时间段：** 以清晰的界面展示可供租赁的工具列表，包括工具图片、描述、日租/时租价格以及可预约的时间段。
*   **押金冻结与归还处理：** 支持租赁押金的在线冻结和工具归还后的自动解冻/归还流程。
*   **工具归还确认流程：** 确保工具归还时有明确的确认机制，例如服务提供者确认、照片上传等。

**2.5 社区动态 **
*   **发帖支持中/英/法多语言字段：** 用户发布动态时，可以为内容添加多语言字段（如 `content_zh`, `content_en`, `content_fr`），以支持多语言内容创作。
*   **系统根据用户语言偏好优先显示匹配语言内容：** 应用将根据当前用户设置的语言偏好，优先显示帖子内容中匹配的语言版本。
*   **无对应语言内容时显示原文或翻译内容（标注自动翻译）：** 如果帖子没有当前用户语言的内容，系统将显示帖子的原始语言内容，或提供由机器自动翻译的内容并进行明确标注。
*   **点赞、评论、举报、附图与定位功能：** 提供丰富的社区互动功能，包括对帖子进行点赞、发表评论、举报不当内容、上传图片和附加地理位置信息。
*   **可切换查看其他语言内容（"显示原文"）：** 用户可以点击按钮（例如"显示英文原文"）来查看帖子的其他可用语言版本。

**2.6 应用内搜索**
*   **按关键词查找服务、工具、用户动态等：** 提供全局搜索功能，允许用户通过关键词快速查找所需的服务、租赁工具、金豆圈内的用户动态以及其他相关信息。

**2.7 多语言支持**
*   **UI 多语言切换：** 应用界面所有文本、标签、按钮等元素均支持中文、英文、法文等多语言的实时切换。
*   **所有内容支持多语言字段结构：** 针对用户生成内容 (UGC) 和平台发布内容，采用多语言字段存储结构（例如 `title_zh`, `title_en`, `title_fr`），确保内容的国际化呈现。
*   **自动翻译建议缓存字段供英文用户浏览：** 对于非英文内容的帖子，系统可以生成自动翻译版本并缓存 (`content_translated_en`)，以提高英文用户的浏览体验，同时保留切换查看原文的选项。

**2.8 客服反馈**
*   **填写意见反馈：** 用户可以填写表单提交对应用的意见、建议或遇到的问题。
*   **与平台客服联系：** 提供在线客服聊天功能或通过邮件直接联系平台支持。

**2.9 插件化机制与扩展支持**
*   **每个功能模块（如服务预约、工具租赁、金豆圈等）作为独立插件进行注册与管理：** 核心功能被设计为可插拔的模块，便于独立开发、测试和部署。
*   **插件通过注册机制挂载到底部导航或特定页面容器中：** 插件可以灵活地集成到应用的导航栏、特定功能页面或动态加载的容器中。
*   **插件支持独立控制器与状态存储，便于动态加载与按需集成：** 每个插件拥有自己的控制器和状态管理，确保模块间的松耦合，支持按需加载和卸载，优化应用性能和资源占用。
*   **插件元数据（如图标、名称、是否启用）统一由后端配置，支持运营灵活启用/停用功能：** 插件的可见性、名称、图标等配置通过后端管理，运营人员可以根据市场策略或功能测试灵活地启用、禁用或调整插件。
*   **插件能力可扩展：** 架构支持未来轻松添加新的功能模块作为插件，例如新增"跑腿服务"、"物品共享"、"技能交易"等。

---

### 三、系统框架描述

**3.1 客户端 Flutter App**
*   **开发框架：** Flutter 3.x，支持 iOS 和 Android 跨平台开发。
*   **状态管理 / 路由 / 国际化：** GetX 框架，提供响应式状态管理、依赖注入、声明式路由管理和多语言解决方案。
*   **响应式布局：** `flutter_screenutil` 用于实现屏幕适配和响应式 UI 设计，确保在不同尺寸设备上的良好显示效果。
*   **多语言库：** `flutter_localizations` 提供 Flutter 框架级别的国际化支持。
*   **插件模块化机制：** 通过 GetX 路由的注入机制和控制器之间的隔离，实现功能模块的插件化。

**3.2 后端 Supabase 服务**
*   **身份验证 (Auth)：** 利用 Supabase 的身份验证服务，支持多种登录方式（邮件、OAuth）。
*   **数据库 (Postgres)：** 使用 Supabase 提供的 PostgreSQL 数据库作为主要数据存储，支持强大的关系型数据管理和查询能力。
*   **存储 (Storage)：** 采用 Supabase Storage 服务进行图片、视频等用户生成内容的存储和管理。
*   **边缘函数 (Function API)：** 可利用 Supabase Edge Functions 实现轻量级、可扩展的后端逻辑。
*   **数据库迁移管理：** 结合 Supabase CLI 工具，对数据库 schema 变更进行版本控制和迁移管理。

**3.3 支付**
*   **Stripe：** 集成 Stripe 支付平台，支持信用卡等多种国际支付方式。
*   **微信支付 SDK：** 通过 Flutter 插件形式集成微信支付 SDK，方便中国用户进行支付。

**3.4 后台管理系统**
*   **技术选型：** 可选用 AdminJS 或基于 Vue + Supabase 自定义开发。
*   **主要功能：**
    *   **服务管理：** 增删改查服务类别、服务详情、服务者信息。
    *   **用户管理：** 查看、编辑用户信息、角色管理、封禁用户。
    *   **评价归纳：** 审核和管理用户对服务及工具的评价。
    *   **文本多语言配置：** 集中管理应用内所有多语言文本的键值对。
    *   **插件控制开关：** 运营人员可以通过后台系统动态启用或停用前端插件模块。

---

### 四、界面 UI 原型描述

**4.1 开场页 (Splash Screen)**
*   **视觉呈现：** 应用启动时显示全屏 App Logo，并伴随流畅的动画效果，持续约 3 秒。
*   **流程引导：** 动画结束后，自动跳转到登录或注册页面，引导用户进入应用。

**4.2 首页流程 (Bottom Tab)**
*   **底部导航栏：** 包含"首页"、"服务"、"金豆圈"、"社区"、"我的"等主要功能模块入口。
*   **首页 (Home Tab)：**
    *   **Banner 轮播图：** 位于页面顶部，展示最新活动、推荐服务或重要通知。
    *   **服务类别绘图四格分配：** 采用简洁的四格布局，以图标和文字形式展示核心服务类别，如"换胎"、"家政"、"租赁"、"其他"，点击进入对应服务列表。
    *   **社区福利（活动/资讯卡片列表）：** 展示金豆圈或社区模块中的精选活动、优惠信息或资讯，以卡片流形式呈现。
    *   **热门服务推荐：** 基于用户好评、附近地理位置或高频使用的服务进行智能推荐，以列表或网格形式展示。

**4.3 服务页 (Services Page)**
*   **服务搜索：** 顶部提供服务关键词搜索框，方便用户快速定位服务。
*   **服务分类筛选：** 列表或网格形式展示各类服务分类，配以图标和类别名称，点击可筛选。
*   **服务列表：** 以卡片或列表项形式展示服务概要，包括服务名称、简要描述、价格、用户评分和主要服务者信息。
*   **服务详情页：** 点击服务列表项进入，展示服务的完整描述、详细价格明细、服务者资质，以及可预约的时间选择器 (`Date Picker`)。
*   **预约按钮：** 服务详情页底部提供"预约"按钮，用户点击后发起订单流程。
*   **工具租赁模块：** 以 Grid 视图展示可供租赁的工具，用户可以选择租赁时长、预约支付，并有明确的押金处理说明。

**4.4 社区页 (Community Page)**
*   **社区福利资讯卡片流：** 呈现金豆圈中的各类活动、补贴、通知等资讯，以可滚动的卡片流形式展示，支持内容根据用户语言偏好显示。
*   **分类筛选：** 提供"活动"、"补贴"、"通知"等分类标签，用户可以进行筛选，查看特定类型的资讯。

**4.5 金豆圈 UI**
*   **动态展示：** 每个帖子（动态）以卡片形式展示，包含用户头像、昵称、发帖内容、附带图片和地理位置信息。
*   **多语言内容显示：** 发帖内容将根据用户语言偏好优先显示对应的多语言字段。
*   **互动功能：** 提供点赞、评论、转发按钮，支持用户对帖子进行互动。
*   **语言切换按钮：** 对于多语言内容，提供如"显示英文原文"等按钮，允许用户在不同语言版本之间切换。

**4.6 我的页面 (My Page/Profile Page)**
*   **用户信息展示：** 页面顶部显示用户头像、昵称，并提供编辑入口。
*   **账户信息编辑：** 包含个人资料编辑的入口。
*   **我的订单：** 汇总服务订单和工具租赁订单的列表。
*   **收藏服务：** 展示用户收藏的服务列表。
*   **切换角色按钮：** 提供用户和（未来的）服务者角色之间的切换功能。
*   **语言切换：** 提供语言切换的入口，允许用户更改应用界面语言。

---

### 五、特殊需求

*   **插件注册表管理各功能模块可插拔性：** 建立一个中心化的插件注册表，用于管理所有功能模块（插件）的生命周期、元数据和集成点，确保应用的高度可插拔性和动态扩展能力。
*   **接口设计方便后期接 AI 推荐、智能搭配、自动匹配服务者：** API 接口设计应具备灵活性和可扩展性，为未来集成 AI 驱动的个性化推荐、服务智能搭配和基于算法的服务者自动匹配功能预留接口。
*   **支持推送通知：** 集成推送通知服务（如 FCM 或 Supabase Edge Functions），实现订单状态更新、新消息、社区活动等实时通知功能。
*   **实时评价刷新：** 确保用户对服务或工具的评价能够实时更新并反映在服务者或工具的详情页面上。
*   **系统支持联合资深后台 SaaS 服务：** 考虑与专业的后台 SaaS 服务（例如 CRM、工单系统、营销自动化工具）进行集成，以增强平台的运营和管理能力。
*   **社区内容语言一致性机制：**
    *   **支持用户根据语言喜好自动筛选内容：** 社区内容流可以根据用户的语言偏好进行智能筛选，优先显示用户熟悉或感兴趣的语言内容。
    *   **多语言字段存储与显示：** 所有社区发布内容均采用多语言字段（如 `body_zh`, `body_en`）存储，确保内容在不同语言环境下的原生显示。
    *   **自动翻译后缓存机制 + 原文切换：** 对于非用户首选语言的内容，系统将提供自动翻译服务，并将翻译结果进行缓存，以减少重复翻译的开销。同时，用户始终可以切换查看内容的原始语言版本。

### 1.3 范围
本阶段项目范围包括以下核心功能：
*   增强型启动欢迎页（Splash Welcome Page）。
*   用户登录与注册（含邮箱/密码及社交登录UI）。
*   底部导航栏及其承载的四个主要功能模块：首页、服务、社区、个人中心。
*   各功能模块的基本UI展示和 mock 数据集成。
*   多语言切换能力（英语和中文）。

## 2. 利益相关者

*   **终端用户**: 金豆荚App的日常使用者，期望获得便捷、高效的服务体验。
*   **产品经理**: 负责定义和完善App的功能与用户体验。
*   **开发团队**: 负责App的设计、开发与维护。
*   **后端服务提供商/团队**: 提供认证、数据存储和业务逻辑API（当前阶段为Mock）。
*   **Figma 设计师**: 提供App的UI/UX设计稿。

## 3. 功能需求 (Functional Requirements)

### 3.1 启动与认证模块 (Auth Plugin)

*   **RQ-AUTH-001**: 应用启动时，应显示一个带有品牌Logo、欢迎语及动画效果的启动欢迎页。
*   **RQ-AUTH-002**: 启动页加载完成后，应显示"Sign In"和"Sign Up"按钮，供用户选择进入登录或注册流程。
*   **RQ-AUTH-003**: 登录页面应提供邮箱/密码输入字段，并支持密码显示/隐藏切换。
*   **RQ-AUTH-004**: 登录页面应提供"Google Sign In"和"Apple Sign In"按钮（UI已实现，功能待集成）。
*   **RQ-AUTH-005**: 用户可以通过邮箱和密码进行注册，注册成功后应导航至登录页面。
*   **RQ-AUTH-006**: 应用应能持久化用户的登录状态，已登录用户直接进入主应用界面。
*   **RQ-AUTH-007**: 用户应能通过个人中心页面的"Logout"按钮安全退出登录。

### 3.2 插件管理系统 (Plugin Management)

*   **RQ-PM-001**: 系统应具备插件注册机制，能够识别和加载不同的功能模块（如 Auth, Home, Service, Community, Profile）。
*   **RQ-PM-002**: 系统应能根据配置（当前为硬编码，未来可来自后端）动态启用或禁用特定插件。
*   **RQ-PM-003**: 底部导航栏应根据启用的底部导航类型插件动态生成。
*   **RQ-PM-004**: 每个插件应能定义自己的路由、绑定和入口Widget。

### 3.3 主应用壳 (ShellApp)

*   **RQ-SHELL-001**: 主应用壳应包含一个底部导航栏，用于切换不同的底部标签页插件。
*   **RQ-SHELL-002**: 底部导航栏应显示插件元数据中定义的图标和简短名称。
*   **RQ-SHELL-003**: 切换底部标签页时，应保持已加载页面的状态。

### 3.4 首页模块 (Home Plugin)

*   **RQ-HOME-001**: 首页应展示用户欢迎信息（例如用户邮箱）。
*   **RQ-HOME-002**: 首页应包含通知列表。
*   **RQ-HOME-003**: 首页应展示社区活动和推荐服务卡片（当前为Mock数据）。
*   **RQ-HOME-004**: 首页应提供"Logout"按钮，方便用户退出登录。

### 3.5 服务预约模块 (Service Booking Plugin)

*   **RQ-SERVICE-001**: 服务页面应包含一个搜索栏。
*   **RQ-SERVICE-002**: 服务页面应展示可过滤的服务类别（例如"居家服务"、"美容健康"等）。
*   **RQ-SERVICE-003**: 服务页面应展示热门服务列表，包含名称、描述、价格、图片、评分和评论数（当前为Mock数据）。

### 3.6 社区模块 (Community Plugin)

*   **RQ-COMM-001**: 社区页面应包含一个自定义的AppBar，带有标题。
*   **RQ-COMM-002**: 社区页面应包含一个Tab Bar，用于过滤不同类型的社区帖子（例如"活动"、"补贴"、"公告"）。
*   **RQ-COMM-003**: 社区页面应展示社区帖子列表，包含标题、描述、图片、作者和时间戳等信息（当前为Mock数据）。

### 3.7 个人中心模块 (Profile Plugin)

*   **RQ-PROFILE-001**: 个人中心页面应展示用户头像、用户名和注册时间（当前为Mock数据）。
*   **RQ-PROFILE-002**: 个人中心页面应分节展示账户相关菜单项（如"编辑资料"、"订单历史"、"收藏服务"等）。
*   **RQ-PROFILE-003**: 个人中心页面应分节展示设置相关菜单项（如"语言"）。
*   **RQ-PROFILE-004**: 菜单项应支持点击事件（当前为打印日志，未来可导航到具体页面）。

## 4. 非功能需求 (Non-functional Requirements)

### 4.1 性能 (Performance)
*   **NFR-PERF-001**: 启动欢迎页面的动画应流畅，无卡顿。
*   **NFR-PERF-002**: 页面切换应迅速响应，无明显延迟。

### 4.2 可扩展性 (Scalability)
*   **NFR-SCALE-001**: 插件化架构应支持未来新增、移除或更新功能模块，而无需大规模修改核心代码。
*   **NFR-SCALE-002**: 业务逻辑和UI应解耦，便于独立扩展。

### 4.3 可维护性 (Maintainability)
*   **NFR-MAINT-001**: 代码应遵循Dart和Flutter的最佳实践，保持高可读性和一致性。
*   **NFR-MAINT-002**: 模块化结构应简化调试和问题定位。
*   **NFR-MAINT-003**: 依赖管理应清晰，便于更新和解决冲突。

### 4.4 可用性 (Usability)
*   **NFR-USABILITY-001**: 用户界面应与 Figma 设计稿保持高度一致。
*   **NFR-USABILITY-002**: 应用流程应直观易懂，提供良好的用户体验。

### 4.5 安全性 (Security - 当前阶段考虑)
*   **NFR-SEC-001**: 认证信息（如用户邮箱）应本地持久化。
*   **NFR-SEC-002**: 未来与真实后端集成时，应考虑数据加密和安全的认证授权机制（OAuth2, JWT等）。

### 4.6 国际化 (Internationalization)
*   **NFR-I18N-001**: 应用应支持英文和中文界面显示。
*   **NFR-I18N-002**: 所有面向用户的文本（包括底部导航栏名称）应通过国际化机制管理。

## 六、新增需求与业务说明（2024-07-03）

### 6.1 多角色用户登录与切换
- 支持 customer、provider、customer+provider 多角色用户。
- 登录页支持多角色用户选择角色，登录后进入对应主页面。
- profile 页支持角色切换，只有用户主动点击才切换。

### 6.2 provider 端独立导航
- provider 端采用独立 ProviderShellApp，彻底与插件式 tab 隔离。
- customer 端采用 ShellApp，动态 bottomTab。
- provider/customer 端主页面结构、导航、业务逻辑彻底隔离。

### 6.3 主题 per-role 记忆与切换
- 主题设置支持 per-role 记忆，切换角色自动切换主题。
- 支持 dark teal、golden 两套主题，所有 UI 颜色响应主题变化。 